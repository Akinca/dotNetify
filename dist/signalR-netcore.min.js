!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.signalR=b()}(this,function(){"use strict";function a(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function b(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function c(a,b){return b={exports:{}},a(b,b.exports),b.exports}function d(a,b){function c(){this.constructor=a}w(a,b),a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)}function e(a,b){var c={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&b.indexOf(d)<0&&(c[d]=a[d]);if(null!=a&&"function"==typeof Object.getOwnPropertySymbols)for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++)b.indexOf(d[e])<0&&(c[d[e]]=a[d[e]]);return c}function f(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g}function g(a,b){return function(c,d){b(c,d,a)}}function h(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)}function i(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b||[])).next())})}function j(a,b){function c(a){return function(b){return d([a,b])}}function d(c){if(e)throw new TypeError("Generator is already executing.");for(;i;)try{if(e=1,f&&(g=f[2&c[0]?"return":c[0]?"throw":"next"])&&!(g=g.call(f,c[1])).done)return g;switch(f=0,g&&(c=[0,g.value]),c[0]){case 0:case 1:g=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,f=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(g=i.trys,!(g=g.length>0&&g[g.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!g||c[1]>g[0]&&c[1]<g[3])){i.label=c[1];break}if(6===c[0]&&i.label<g[1]){i.label=g[1],g=c;break}if(g&&i.label<g[2]){i.label=g[2],i.ops.push(c);break}g[2]&&i.ops.pop(),i.trys.pop();continue}c=b.call(a,i)}catch(a){c=[6,a],f=0}finally{e=g=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}var e,f,g,h,i={label:0,sent:function(){if(1&g[0])throw g[1];return g[1]},trys:[],ops:[]};return h={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h}function k(a,b){for(var c in a)b.hasOwnProperty(c)||(b[c]=a[c])}function l(a){var b="function"==typeof Symbol&&a[Symbol.iterator],c=0;return b?b.call(a):{next:function(){return a&&c>=a.length&&(a=void 0),{value:a&&a[c++],done:!a}}}}function m(a,b){var c="function"==typeof Symbol&&a[Symbol.iterator];if(!c)return a;var d,e,f=c.call(a),g=[];try{for(;(void 0===b||b-- >0)&&!(d=f.next()).done;)g.push(d.value)}catch(a){e={error:a}}finally{try{d&&!d.done&&(c=f.return)&&c.call(f)}finally{if(e)throw e.error}}return g}function n(){for(var a=[],b=0;b<arguments.length;b++)a=a.concat(m(arguments[b]));return a}function o(a){return this instanceof o?(this.v=a,this):new o(a)}function p(a,b,c){function d(a){k[a]&&(j[a]=function(b){return new Promise(function(c,d){l.push([a,b,c,d])>1||e(a,b)})})}function e(a,b){try{f(k[a](b))}catch(a){i(l[0][3],a)}}function f(a){a.value instanceof o?Promise.resolve(a.value.v).then(g,h):i(l[0][2],a)}function g(a){e("next",a)}function h(a){e("throw",a)}function i(a,b){a(b),l.shift(),l.length&&e(l[0][0],l[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var j,k=c.apply(a,b||[]),l=[];return j={},d("next"),d("throw"),d("return"),j[Symbol.asyncIterator]=function(){return this},j}function q(a){function b(b,e){a[b]&&(c[b]=function(c){return(d=!d)?{value:o(a[b](c)),done:"return"===b}:e?e(c):c})}var c,d;return c={},b("next"),b("throw",function(a){throw a}),b("return"),c[Symbol.iterator]=function(){return this},c}function r(a){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var b=a[Symbol.asyncIterator];return b?b.call(a):"function"==typeof l?l(a):a[Symbol.iterator]()}function s(a,b){return Object.defineProperty?Object.defineProperty(a,"raw",{value:b}):a.raw=b,a}function t(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function u(a){return a&&a.__esModule?a:{default:a}}var v="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])},x=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a},y=Object.freeze({__extends:d,__assign:x,__rest:e,__decorate:f,__param:g,__metadata:h,__awaiter:i,__generator:j,__exportStar:k,__values:l,__read:m,__spread:n,__await:o,__asyncGenerator:p,__asyncDelegator:q,__asyncValues:r,__makeTemplateObject:s,__importStar:t,__importDefault:u}),z=(c(function(b,c){!function(a,c){b.exports=c()}(v,function(){function b(a){var b=typeof a;return null!==a&&("object"===b||"function"===b)}function c(a){return"function"==typeof a}function d(a){U=a}function e(a){V=a}function f(){return function(){return process.nextTick(k)}}function g(){return"undefined"!=typeof T?function(){T(k)}:j()}function h(){var a=0,b=new Y(k),c=document.createTextNode("");return b.observe(c,{characterData:!0}),function(){c.data=a=++a%2}}function i(){var a=new MessageChannel;return a.port1.onmessage=k,function(){return a.port2.postMessage(0)}}function j(){var a=setTimeout;return function(){return a(k,1)}}function k(){for(var a=0;a<S;a+=2){var b=_[a],c=_[a+1];b(c),_[a]=void 0,_[a+1]=void 0}S=0}function l(){try{var b=a,c=b("vertx");return T=c.runOnLoop||c.runOnContext,g()}catch(a){return j()}}function m(a,b){var c=this,d=new this.constructor(o);void 0===d[ba]&&I(d);var e=c._state;if(e){var f=arguments[e-1];V(function(){return F(e,d,f,c._result)})}else B(c,d,a,b);return d}function n(a){var b=this;if(a&&"object"==typeof a&&a.constructor===b)return a;var c=new b(o);return x(c,a),c}function o(){}function p(){return new TypeError("You cannot resolve a promise with itself")}function q(){return new TypeError("A promises callback cannot return that same promise.")}function r(a){try{return a.then}catch(a){return fa.error=a,fa}}function s(a,b,c,d){try{a.call(b,c,d)}catch(a){return a}}function t(a,b,c){V(function(a){var d=!1,e=s(c,b,function(c){d||(d=!0,b!==c?x(a,c):z(a,c))},function(b){d||(d=!0,A(a,b))},"Settle: "+(a._label||" unknown promise"));!d&&e&&(d=!0,A(a,e))},a)}function u(a,b){b._state===da?z(a,b._result):b._state===ea?A(a,b._result):B(b,void 0,function(b){return x(a,b)},function(b){return A(a,b)})}function w(a,b,d){b.constructor===a.constructor&&d===m&&b.constructor.resolve===n?u(a,b):d===fa?(A(a,fa.error),fa.error=null):void 0===d?z(a,b):c(d)?t(a,b,d):z(a,b)}function x(a,c){a===c?A(a,p()):b(c)?w(a,c,r(c)):z(a,c)}function y(a){a._onerror&&a._onerror(a._result),C(a)}function z(a,b){a._state===ca&&(a._result=b,a._state=da,0!==a._subscribers.length&&V(C,a))}function A(a,b){a._state===ca&&(a._state=ea,a._result=b,V(y,a))}function B(a,b,c,d){var e=a._subscribers,f=e.length;a._onerror=null,e[f]=b,e[f+da]=c,e[f+ea]=d,0===f&&a._state&&V(C,a)}function C(a){var b=a._subscribers,c=a._state;if(0!==b.length){for(var d=void 0,e=void 0,f=a._result,g=0;g<b.length;g+=3)d=b[g],e=b[g+c],d?F(c,d,e,f):e(f);a._subscribers.length=0}}function D(){this.error=null}function E(a,b){try{return a(b)}catch(a){return ga.error=a,ga}}function F(a,b,d,e){var f=c(d),g=void 0,h=void 0,i=void 0,j=void 0;if(f){if(g=E(d,e),g===ga?(j=!0,h=g.error,g.error=null):i=!0,b===g)return void A(b,q())}else g=e,i=!0;b._state!==ca||(f&&i?x(b,g):j?A(b,h):a===da?z(b,g):a===ea&&A(b,g))}function G(a,b){try{b(function(b){x(a,b)},function(b){A(a,b)})}catch(b){A(a,b)}}function H(){return ha++}function I(a){a[ba]=ha++,a._state=void 0,a._result=void 0,a._subscribers=[]}function J(){return new Error("Array Methods must be provided an Array")}function J(){return new Error("Array Methods must be provided an Array")}function K(a){return new ia(this,a).promise}function L(a){var b=this;return new b(R(a)?function(c,d){for(var e=a.length,f=0;f<e;f++)b.resolve(a[f]).then(c,d)}:function(a,b){return b(new TypeError("You must pass an array to race."))})}function M(a){var b=this,c=new b(o);return A(c,a),c}function N(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function O(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function P(){var a=void 0;if("undefined"!=typeof v)a=v;else if("undefined"!=typeof self)a=self;else try{a=Function("return this")()}catch(a){throw new Error("polyfill failed because global object is unavailable in this environment")}var b=a.Promise;if(b){var c=null;try{c=Object.prototype.toString.call(b.resolve())}catch(a){}if("[object Promise]"===c&&!b.cast)return}a.Promise=ja}var Q=void 0;Q=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)};var R=Q,S=0,T=void 0,U=void 0,V=function(a,b){_[S]=a,_[S+1]=b,S+=2,2===S&&(U?U(k):aa())},W="undefined"!=typeof window?window:void 0,X=W||{},Y=X.MutationObserver||X.WebKitMutationObserver,Z="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),$="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,_=new Array(1e3),aa=void 0;aa=Z?f():Y?h():$?i():void 0===W&&"function"==typeof a?l():j();var ba=Math.random().toString(36).substring(16),ca=void 0,da=1,ea=2,fa=new D,ga=new D,ha=0,ia=function(){function a(a,b){this._instanceConstructor=a,this.promise=new a(o),this.promise[ba]||I(this.promise),R(b)?(this.length=b.length,this._remaining=b.length,this._result=new Array(this.length),0===this.length?z(this.promise,this._result):(this.length=this.length||0,this._enumerate(b),0===this._remaining&&z(this.promise,this._result))):A(this.promise,J())}return a.prototype._enumerate=function(a){for(var b=0;this._state===ca&&b<a.length;b++)this._eachEntry(a[b],b)},a.prototype._eachEntry=function(a,b){var c=this._instanceConstructor,d=c.resolve;if(d===n){var e=r(a);if(e===m&&a._state!==ca)this._settledAt(a._state,b,a._result);else if("function"!=typeof e)this._remaining--,this._result[b]=a;else if(c===ja){var f=new c(o);w(f,a,e),this._willSettleAt(f,b)}else this._willSettleAt(new c(function(b){return b(a)}),b)}else this._willSettleAt(d(a),b)},a.prototype._settledAt=function(a,b,c){var d=this.promise;d._state===ca&&(this._remaining--,a===ea?A(d,c):this._result[b]=c),0===this._remaining&&z(d,this._result)},a.prototype._willSettleAt=function(a,b){var c=this;B(a,void 0,function(a){return c._settledAt(da,b,a)},function(a){return c._settledAt(ea,b,a)})},a}(),ja=function(){function a(b){this[ba]=H(),this._result=this._state=void 0,this._subscribers=[],o!==b&&("function"!=typeof b&&N(),this instanceof a?G(this,b):O())}return a.prototype.catch=function(a){return this.then(null,a)},a.prototype.finally=function(a){var b=this,c=b.constructor;return b.then(function(b){return c.resolve(a()).then(function(){return b})},function(b){return c.resolve(a()).then(function(){throw b})})},a}();return ja.prototype.then=m,ja.all=K,ja.race=L,ja.resolve=n,ja.reject=M,ja._setScheduler=d,ja._setAsap=e,ja._asap=V,ja.polyfill=P,ja.Promise=ja,ja.polyfill(),ja})}),c(function(a,b){Object.defineProperty(b,"__esModule",{value:!0});var c=function(a){function b(b,c){var d=this.constructor,e=this,f=d.prototype;return e=a.call(this,b)||this,e.statusCode=c,e.__proto__=f,e}return y.__extends(b,a),b}(Error);b.HttpError=c;var d=function(a){function b(b){var c=this.constructor;void 0===b&&(b="A timeout occurred.");var d=this,e=c.prototype;return d=a.call(this,b)||this,d.__proto__=e,d}return y.__extends(b,a),b}(Error);b.TimeoutError=d}));b(z);var A=(z.HttpError,z.TimeoutError,c(function(a,b){Object.defineProperty(b,"__esModule",{value:!0});var c;!function(a){a[a.Trace=0]="Trace",a[a.Debug=1]="Debug",a[a.Information=2]="Information",a[a.Warning=3]="Warning",a[a.Error=4]="Error",a[a.Critical=5]="Critical",a[a.None=6]="None"}(c=b.LogLevel||(b.LogLevel={}))}));b(A);var B=(A.LogLevel,c(function(a,b){Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(a,b,c){this.statusCode=a,this.statusText=b,this.content=c}return a}();b.HttpResponse=c;var d=function(){function a(){}return a.prototype.get=function(a,b){return this.send(y.__assign({},b,{method:"GET",url:a}))},a.prototype.post=function(a,b){return this.send(y.__assign({},b,{method:"POST",url:a}))},a.prototype.delete=function(a,b){return this.send(y.__assign({},b,{method:"DELETE",url:a}))},a}();b.HttpClient=d;var e=function(a){function b(b){var c=a.call(this)||this;return c.logger=b,c}return y.__extends(b,a),b.prototype.send=function(a){var b=this;return new Promise(function(d,e){var f=new XMLHttpRequest;f.open(a.method,a.url,!0),f.withCredentials=!0,f.setRequestHeader("X-Requested-With","XMLHttpRequest"),f.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),a.headers&&Object.keys(a.headers).forEach(function(b){return f.setRequestHeader(b,a.headers[b])}),a.responseType&&(f.responseType=a.responseType),a.abortSignal&&(a.abortSignal.onabort=function(){f.abort()}),a.timeout&&(f.timeout=a.timeout),f.onload=function(){a.abortSignal&&(a.abortSignal.onabort=null),f.status>=200&&f.status<300?d(new c(f.status,f.statusText,f.response||f.responseText)):e(new z.HttpError(f.statusText,f.status))},f.onerror=function(){b.logger.log(A.LogLevel.Warning,"Error from HTTP request. "+f.status+": "+f.statusText),e(new z.HttpError(f.statusText,f.status))},f.ontimeout=function(){b.logger.log(A.LogLevel.Warning,"Timeout from HTTP request."),e(new z.TimeoutError)},f.send(a.content||"")})},b}(d);b.DefaultHttpClient=e}));b(B);var C=(B.HttpResponse,B.HttpClient,B.DefaultHttpClient,c(function(a,b){Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(){}return a.write=function(b){return""+b+a.RecordSeparator},a.parse=function(b){if(b[b.length-1]!==a.RecordSeparator)throw new Error("Message is incomplete.");var c=b.split(a.RecordSeparator);return c.pop(),c},a.RecordSeparatorCode=30,a.RecordSeparator=String.fromCharCode(a.RecordSeparatorCode),a}();b.TextMessageFormat=c}));b(C);var D=(C.TextMessageFormat,c(function(a,b){Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(){}return a.prototype.writeHandshakeRequest=function(a){return C.TextMessageFormat.write(JSON.stringify(a))},a.prototype.parseHandshakeResponse=function(a){var b,c,d;if(a instanceof ArrayBuffer){var e=new Uint8Array(a),f=e.indexOf(C.TextMessageFormat.RecordSeparatorCode);if(f===-1)throw new Error("Message is incomplete.");var g=f+1;c=String.fromCharCode.apply(null,e.slice(0,g)),d=e.byteLength>g?e.slice(g).buffer:null}else{var h=a,f=h.indexOf(C.TextMessageFormat.RecordSeparator);if(f===-1)throw new Error("Message is incomplete.");var g=f+1;c=h.substring(0,g),d=h.length>g?h.substring(g):null}var i=C.TextMessageFormat.parse(c);return b=JSON.parse(i[0]),[d,b]},a}();b.HandshakeProtocol=c}));b(D);var E=(D.HandshakeProtocol,c(function(a,b){Object.defineProperty(b,"__esModule",{value:!0});var c;!function(a){a[a.Invocation=1]="Invocation",a[a.StreamItem=2]="StreamItem",a[a.Completion=3]="Completion",a[a.StreamInvocation=4]="StreamInvocation",a[a.CancelInvocation=5]="CancelInvocation",a[a.Ping=6]="Ping",a[a.Close=7]="Close"}(c=b.MessageType||(b.MessageType={}))}));b(E);var F=(E.MessageType,c(function(a,b){Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(){}return a.prototype.log=function(a,b){},a.instance=new a,a}();b.NullLogger=c}));b(F);var G=(F.NullLogger,c(function(a,b){function c(a,b){var c=null;return a instanceof ArrayBuffer?(c="Binary data of length "+a.byteLength,b&&(c+=". Content: '"+d(a)+"'")):"string"==typeof a&&(c="String data of length "+a.length,b&&(c+=". Content: '"+a+"'.")),c}function d(a){var b=new Uint8Array(a),c="";return b.forEach(function(a){var b=a<16?"0":"";c+="0x"+b+a.toString(16)+" "}),c.substr(0,c.length-1)}function e(a,b,d,e,f,g,h){return y.__awaiter(this,void 0,void 0,function(){var i,j,k,l;return y.__generator(this,function(m){switch(m.label){case 0:return[4,f()];case 1:return j=m.sent(),j&&(l={},l.Authorization="Bearer "+j,i=l),a.log(A.LogLevel.Trace,"("+b+" transport) sending data. "+c(g,h)+"."),[4,d.post(e,{content:g,headers:i})];case 2:return k=m.sent(),a.log(A.LogLevel.Trace,"("+b+" transport) request complete. Response status: "+k.statusCode+"."),[2]}})})}function f(a){return void 0===a?new j(A.LogLevel.Information):null===a?F.NullLogger.instance:a.log?a:new j(a)}Object.defineProperty(b,"__esModule",{value:!0});var g=function(){function a(){}return a.isRequired=function(a,b){if(null===a||void 0===a)throw new Error("The '"+b+"' argument is required.")},a.isIn=function(a,b,c){if(!(a in b))throw new Error("Unknown "+c+" value: "+a+".")},a}();b.Arg=g,b.getDataDetail=c,b.formatArrayBuffer=d,b.sendMessage=e,b.createLogger=f;var h=function(){function a(a){this.observers=[],this.cancelCallback=a}return a.prototype.next=function(a){for(var b=0,c=this.observers;b<c.length;b++){var d=c[b];d.next(a)}},a.prototype.error=function(a){for(var b=0,c=this.observers;b<c.length;b++){var d=c[b];d.error&&d.error(a)}},a.prototype.complete=function(){for(var a=0,b=this.observers;a<b.length;a++){var c=b[a];c.complete&&c.complete()}},a.prototype.subscribe=function(a){return this.observers.push(a),new i(this,a)},a}();b.Subject=h;var i=function(){function a(a,b){this.subject=a,this.observer=b}return a.prototype.dispose=function(){var a=this.subject.observers.indexOf(this.observer);a>-1&&this.subject.observers.splice(a,1),0===this.subject.observers.length&&this.subject.cancelCallback().catch(function(a){})},a}();b.SubjectSubscription=i;var j=function(){function a(a){this.minimumLogLevel=a}return a.prototype.log=function(a,b){if(a>=this.minimumLogLevel)switch(a){case A.LogLevel.Critical:case A.LogLevel.Error:console.error(A.LogLevel[a]+": "+b);break;case A.LogLevel.Warning:console.warn(A.LogLevel[a]+": "+b);break;case A.LogLevel.Information:console.info(A.LogLevel[a]+": "+b);break;default:console.log(A.LogLevel[a]+": "+b)}},a}();b.ConsoleLogger=j}));b(G);var H=(G.Arg,G.getDataDetail,G.formatArrayBuffer,G.sendMessage,G.createLogger,G.Subject,G.SubjectSubscription,G.ConsoleLogger,c(function(a,b){Object.defineProperty(b,"__esModule",{value:!0});var c=3e4,d=function(){function a(a,b,d){var e=this;G.Arg.isRequired(a,"connection"),G.Arg.isRequired(b,"logger"),G.Arg.isRequired(d,"protocol"),this.serverTimeoutInMilliseconds=c,this.logger=b,this.protocol=d,this.connection=a,this.handshakeProtocol=new D.HandshakeProtocol,this.connection.onreceive=function(a){return e.processIncomingData(a)},this.connection.onclose=function(a){return e.connectionClosed(a)},this.callbacks={},this.methods={},this.closedCallbacks=[],this.id=0}return a.create=function(b,c,d){return new a(b,c,d)},a.prototype.start=function(){return y.__awaiter(this,void 0,void 0,function(){var a;return y.__generator(this,function(b){switch(b.label){case 0:return a={protocol:this.protocol.name,version:this.protocol.version},this.logger.log(A.LogLevel.Debug,"Starting HubConnection."),this.receivedHandshakeResponse=!1,[4,this.connection.start(this.protocol.transferFormat)];case 1:return b.sent(),this.logger.log(A.LogLevel.Debug,"Sending handshake request."),[4,this.connection.send(this.handshakeProtocol.writeHandshakeRequest(a))];case 2:return b.sent(),this.logger.log(A.LogLevel.Information,"Using HubProtocol '"+this.protocol.name+"'."),this.cleanupTimeout(),this.configureTimeout(),[2]}})})},a.prototype.stop=function(){return this.logger.log(A.LogLevel.Debug,"Stopping HubConnection."),this.cleanupTimeout(),this.connection.stop()},a.prototype.stream=function(a){for(var b=this,c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];var e=this.createStreamInvocation(a,c),f=new G.Subject(function(){var a=b.createCancelInvocation(e.invocationId),c=b.protocol.writeMessage(a);return delete b.callbacks[e.invocationId],b.connection.send(c)});this.callbacks[e.invocationId]=function(a,b){return b?void f.error(b):void(a.type===E.MessageType.Completion?a.error?f.error(new Error(a.error)):f.complete():f.next(a.item))};var g=this.protocol.writeMessage(e);return this.connection.send(g).catch(function(a){f.error(a),delete b.callbacks[e.invocationId]}),f},a.prototype.send=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];var d=this.createInvocation(a,b,!0),e=this.protocol.writeMessage(d);return this.connection.send(e)},a.prototype.invoke=function(a){for(var b=this,c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];var e=this.createInvocation(a,c,!1),f=new Promise(function(a,c){b.callbacks[e.invocationId]=function(b,d){if(d)return void c(d);if(b.type===E.MessageType.Completion){var e=b;e.error?c(new Error(e.error)):a(e.result)}else c(new Error("Unexpected message type: "+b.type))};var d=b.protocol.writeMessage(e);b.connection.send(d).catch(function(a){c(a),delete b.callbacks[e.invocationId]})});return f},a.prototype.on=function(a,b){a&&b&&(a=a.toLowerCase(),this.methods[a]||(this.methods[a]=[]),this.methods[a].indexOf(b)===-1&&this.methods[a].push(b))},a.prototype.off=function(a,b){if(a){a=a.toLowerCase();var c=this.methods[a];if(c)if(b){var d=c.indexOf(b);d!==-1&&(c.splice(d,1),0===c.length&&delete this.methods[a])}else delete this.methods[a]}},a.prototype.onclose=function(a){a&&this.closedCallbacks.push(a)},a.prototype.processIncomingData=function(a){if(this.cleanupTimeout(),this.receivedHandshakeResponse||(a=this.processHandshakeResponse(a),this.receivedHandshakeResponse=!0),a)for(var b=this.protocol.parseMessages(a,this.logger),c=0,d=b;c<d.length;c++){var e=d[c];switch(e.type){case E.MessageType.Invocation:this.invokeClientMethod(e);break;case E.MessageType.StreamItem:case E.MessageType.Completion:var f=this.callbacks[e.invocationId];null!=f&&(e.type===E.MessageType.Completion&&delete this.callbacks[e.invocationId],f(e));break;case E.MessageType.Ping:break;case E.MessageType.Close:this.logger.log(A.LogLevel.Information,"Close message received from server."),this.connection.stop(e.error?new Error("Server returned an error on close: "+e.error):null);break;default:this.logger.log(A.LogLevel.Warning,"Invalid message type: "+e.type)}}this.configureTimeout()},a.prototype.processHandshakeResponse=function(a){var b,c;try{f=this.handshakeProtocol.parseHandshakeResponse(a),c=f[0],b=f[1]}catch(a){var d="Error parsing handshake response: "+a;this.logger.log(A.LogLevel.Error,d);var e=new Error(d);throw this.connection.stop(e),e}if(b.error){var d="Server returned handshake error: "+b.error;this.logger.log(A.LogLevel.Error,d),this.connection.stop(new Error(d))}else this.logger.log(A.LogLevel.Debug,"Server handshake complete.");return c;var f},a.prototype.configureTimeout=function(){var a=this;this.connection.features&&this.connection.features.inherentKeepAlive||(this.timeoutHandle=setTimeout(function(){return a.serverTimeout()},this.serverTimeoutInMilliseconds))},a.prototype.serverTimeout=function(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))},a.prototype.invokeClientMethod=function(a){var b=this,c=this.methods[a.target.toLowerCase()];if(c){if(c.forEach(function(c){return c.apply(b,a.arguments)}),a.invocationId){var d="Server requested a response, which is not supported in this version of the client.";this.logger.log(A.LogLevel.Error,d),this.connection.stop(new Error(d))}}else this.logger.log(A.LogLevel.Warning,"No client method with the name '"+a.target+"' found.")},a.prototype.connectionClosed=function(a){var b=this,c=this.callbacks;this.callbacks={},Object.keys(c).forEach(function(b){var d=c[b];d(void 0,a?a:new Error("Invocation canceled due to connection being closed."))}),this.cleanupTimeout(),this.closedCallbacks.forEach(function(c){return c.apply(b,[a])})},a.prototype.cleanupTimeout=function(){this.timeoutHandle&&clearTimeout(this.timeoutHandle)},a.prototype.createInvocation=function(a,b,c){if(c)return{arguments:b,target:a,type:E.MessageType.Invocation};var d=this.id;return this.id++,{arguments:b,invocationId:d.toString(),target:a,type:E.MessageType.Invocation}},a.prototype.createStreamInvocation=function(a,b){var c=this.id;return this.id++,{arguments:b,invocationId:c.toString(),target:a,type:E.MessageType.StreamInvocation}},a.prototype.createCancelInvocation=function(a){return{invocationId:a,type:E.MessageType.CancelInvocation}},a}();b.HubConnection=d}));b(H);var I=(H.HubConnection,c(function(a,b){Object.defineProperty(b,"__esModule",{value:!0});var c;!function(a){a[a.None=0]="None",a[a.WebSockets=1]="WebSockets",a[a.ServerSentEvents=2]="ServerSentEvents",a[a.LongPolling=4]="LongPolling"}(c=b.HttpTransportType||(b.HttpTransportType={}));var d;!function(a){a[a.Text=1]="Text",a[a.Binary=2]="Binary"}(d=b.TransferFormat||(b.TransferFormat={}))}));b(I);var J=(I.HttpTransportType,I.TransferFormat,c(function(a,b){Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(){this.isAborted=!1}return a.prototype.abort=function(){this.isAborted||(this.isAborted=!0,this.onabort&&this.onabort())},Object.defineProperty(a.prototype,"signal",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"aborted",{get:function(){return this.isAborted},enumerable:!0,configurable:!0}),a}();b.AbortController=c}));b(J);var K=(J.AbortController,c(function(a,b){Object.defineProperty(b,"__esModule",{value:!0});var c=5e3,d=function(){function a(a,b,d,e,f){this.httpClient=a,this.accessTokenFactory=b||function(){return null},this.logger=d,this.pollAbort=new J.AbortController,this.logMessageContent=e,this.shutdownTimeout=f||c}return Object.defineProperty(a.prototype,"pollAborted",{get:function(){return this.pollAbort.aborted},enumerable:!0,configurable:!0}),a.prototype.connect=function(a,b){return y.__awaiter(this,void 0,void 0,function(){var c,d,e,f,g;return y.__generator(this,function(h){switch(h.label){case 0:if(G.Arg.isRequired(a,"url"),G.Arg.isRequired(b,"transferFormat"),G.Arg.isIn(b,I.TransferFormat,"transferFormat"),this.url=a,this.logger.log(A.LogLevel.Trace,"(LongPolling transport) Connecting"),b===I.TransferFormat.Binary&&"string"!=typeof(new XMLHttpRequest).responseType)throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");return c={abortSignal:this.pollAbort.signal,headers:{},timeout:9e4},b===I.TransferFormat.Binary&&(c.responseType="arraybuffer"),[4,this.accessTokenFactory()];case 1:return d=h.sent(),this.updateHeaderToken(c,d),f=a+"&_="+Date.now(),this.logger.log(A.LogLevel.Trace,"(LongPolling transport) polling: "+f),[4,this.httpClient.get(f,c)];case 2:return g=h.sent(),200!==g.statusCode?(this.logger.log(A.LogLevel.Error,"(LongPolling transport) Unexpected response code: "+g.statusCode),e=new z.HttpError(g.statusText,g.statusCode),this.running=!1):this.running=!0,this.poll(this.url,c,e),[2,Promise.resolve()]}})})},a.prototype.updateHeaderToken=function(a,b){return b?void(a.headers.Authorization="Bearer "+b):void(a.headers.Authorization&&delete a.headers.Authorization)},a.prototype.poll=function(a,b,c){return y.__awaiter(this,void 0,void 0,function(){var d,e,f,g;return y.__generator(this,function(h){switch(h.label){case 0:h.trys.push([0,,8,9]),h.label=1;case 1:return this.running?[4,this.accessTokenFactory()]:[3,7];case 2:d=h.sent(),this.updateHeaderToken(b,d),h.label=3;case 3:return h.trys.push([3,5,,6]),e=a+"&_="+Date.now(),this.logger.log(A.LogLevel.Trace,"(LongPolling transport) polling: "+e),[4,this.httpClient.get(e,b)];case 4:return f=h.sent(),204===f.statusCode?(this.logger.log(A.LogLevel.Information,"(LongPolling transport) Poll terminated by server"),this.running=!1):200!==f.statusCode?(this.logger.log(A.LogLevel.Error,"(LongPolling transport) Unexpected response code: "+f.statusCode),c=new z.HttpError(f.statusText,f.statusCode),this.running=!1):f.content?(this.logger.log(A.LogLevel.Trace,"(LongPolling transport) data received. "+G.getDataDetail(f.content,this.logMessageContent)),this.onreceive&&this.onreceive(f.content)):this.logger.log(A.LogLevel.Trace,"(LongPolling transport) Poll timed out, reissuing."),[3,6];case 5:return g=h.sent(),this.running?g instanceof z.TimeoutError?this.logger.log(A.LogLevel.Trace,"(LongPolling transport) Poll timed out, reissuing."):(c=g,this.running=!1):this.logger.log(A.LogLevel.Trace,"(LongPolling transport) Poll errored after shutdown: "+g.message),[3,6];case 6:return[3,1];case 7:return[3,9];case 8:return this.stopped=!0,this.shutdownTimer&&clearTimeout(this.shutdownTimer),this.onclose&&(this.logger.log(A.LogLevel.Trace,"(LongPolling transport) Firing onclose event. Error: "+(c||"<undefined>")),this.onclose(c)),this.logger.log(A.LogLevel.Trace,"(LongPolling transport) Transport finished."),[7];case 9:return[2]}})})},a.prototype.send=function(a){return y.__awaiter(this,void 0,void 0,function(){return y.__generator(this,function(b){return this.running?[2,G.sendMessage(this.logger,"LongPolling",this.httpClient,this.url,this.accessTokenFactory,a,this.logMessageContent)]:[2,Promise.reject(new Error("Cannot send until the transport is connected"))]})})},a.prototype.stop=function(){return y.__awaiter(this,void 0,void 0,function(){var a,b,c,d=this;return y.__generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,,3,4]),this.running=!1,this.logger.log(A.LogLevel.Trace,"(LongPolling transport) sending DELETE request to "+this.url+"."),a={headers:{}},[4,this.accessTokenFactory()];case 1:return b=e.sent(),this.updateHeaderToken(a,b),[4,this.httpClient.delete(this.url,a)];case 2:return c=e.sent(),this.logger.log(A.LogLevel.Trace,"(LongPolling transport) DELETE request accepted."),[3,4];case 3:return this.stopped||(this.shutdownTimer=setTimeout(function(){d.logger.log(A.LogLevel.Warning,"(LongPolling transport) server did not terminate after DELETE request, canceling poll."),d.pollAbort.abort()},this.shutdownTimeout)),[7];case 4:return[2]}})})},a}();b.LongPollingTransport=d}));b(K);var L=(K.LongPollingTransport,c(function(a,b){Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(a,b,c,d){this.httpClient=a,this.accessTokenFactory=b||function(){return null},this.logger=c,this.logMessageContent=d}return a.prototype.connect=function(a,b){return y.__awaiter(this,void 0,void 0,function(){var c,d=this;return y.__generator(this,function(e){switch(e.label){case 0:if(G.Arg.isRequired(a,"url"),G.Arg.isRequired(b,"transferFormat"),G.Arg.isIn(b,I.TransferFormat,"transferFormat"),"undefined"==typeof EventSource)throw new Error("'EventSource' is not supported in your environment.");return this.logger.log(A.LogLevel.Trace,"(SSE transport) Connecting"),[4,this.accessTokenFactory()];case 1:return c=e.sent(),c&&(a+=(a.indexOf("?")<0?"?":"&")+("access_token="+encodeURIComponent(c))),this.url=a,[2,new Promise(function(c,e){var f=!1;b!==I.TransferFormat.Text&&e(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"));var g=new EventSource(a,{withCredentials:!0});try{g.onmessage=function(a){if(d.onreceive)try{d.logger.log(A.LogLevel.Trace,"(SSE transport) data received. "+G.getDataDetail(a.data,d.logMessageContent)+"."),d.onreceive(a.data)}catch(a){return void(d.onclose&&d.onclose(a))}},g.onerror=function(a){var b=new Error(a.message||"Error occurred");f?d.close(b):e(b)},g.onopen=function(){d.logger.log(A.LogLevel.Information,"SSE connected to "+d.url),
d.eventSource=g,f=!0,c()}}catch(a){return Promise.reject(a)}})]}})})},a.prototype.send=function(a){return y.__awaiter(this,void 0,void 0,function(){return y.__generator(this,function(b){return this.eventSource?[2,G.sendMessage(this.logger,"SSE",this.httpClient,this.url,this.accessTokenFactory,a,this.logMessageContent)]:[2,Promise.reject(new Error("Cannot send until the transport is connected"))]})})},a.prototype.stop=function(){return this.close(),Promise.resolve()},a.prototype.close=function(a){this.eventSource&&(this.eventSource.close(),this.eventSource=null,this.onclose&&this.onclose(a))},a}();b.ServerSentEventsTransport=c}));b(L);var M=(L.ServerSentEventsTransport,c(function(a,b){Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(a,b,c){this.logger=b,this.accessTokenFactory=a||function(){return null},this.logMessageContent=c}return a.prototype.connect=function(a,b){return y.__awaiter(this,void 0,void 0,function(){var c,d=this;return y.__generator(this,function(e){switch(e.label){case 0:if(G.Arg.isRequired(a,"url"),G.Arg.isRequired(b,"transferFormat"),G.Arg.isIn(b,I.TransferFormat,"transferFormat"),"undefined"==typeof WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return this.logger.log(A.LogLevel.Trace,"(WebSockets transport) Connecting"),[4,this.accessTokenFactory()];case 1:return c=e.sent(),c&&(a+=(a.indexOf("?")<0?"?":"&")+("access_token="+encodeURIComponent(c))),[2,new Promise(function(c,e){a=a.replace(/^http/,"ws");var f=new WebSocket(a);b===I.TransferFormat.Binary&&(f.binaryType="arraybuffer"),f.onopen=function(b){d.logger.log(A.LogLevel.Information,"WebSocket connected to "+a),d.webSocket=f,c()},f.onerror=function(a){e(a.error)},f.onmessage=function(a){d.logger.log(A.LogLevel.Trace,"(WebSockets transport) data received. "+G.getDataDetail(a.data,d.logMessageContent)+"."),d.onreceive&&d.onreceive(a.data)},f.onclose=function(a){d.logger.log(A.LogLevel.Trace,"(WebSockets transport) socket closed."),d.onclose&&(a.wasClean===!1||1e3!==a.code?d.onclose(new Error("Websocket closed with status code: "+a.code+" ("+a.reason+")")):d.onclose())}})]}})})},a.prototype.send=function(a){return this.webSocket&&this.webSocket.readyState===WebSocket.OPEN?(this.logger.log(A.LogLevel.Trace,"(WebSockets transport) sending data. "+G.getDataDetail(a,this.logMessageContent)+"."),this.webSocket.send(a),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")},a.prototype.stop=function(){return this.webSocket&&(this.webSocket.close(),this.webSocket=null),Promise.resolve()},a}();b.WebSocketTransport=c}));b(M);var N=(M.WebSocketTransport,c(function(a,b){function c(a,b){return!a||0!==(b&a)}Object.defineProperty(b,"__esModule",{value:!0});var d=100,e=function(){function a(a,b){void 0===b&&(b={}),this.features={},G.Arg.isRequired(a,"url"),this.logger=G.createLogger(b.logger),this.baseUrl=this.resolveUrl(a),b=b||{},b.accessTokenFactory=b.accessTokenFactory||function(){return null},b.logMessageContent=b.logMessageContent||!1,this.httpClient=b.httpClient||new B.DefaultHttpClient(this.logger),this.connectionState=2,this.options=b}return a.prototype.start=function(a){return a=a||I.TransferFormat.Binary,G.Arg.isIn(a,I.TransferFormat,"transferFormat"),this.logger.log(A.LogLevel.Debug,"Starting connection with transfer format '"+I.TransferFormat[a]+"'."),2!==this.connectionState?Promise.reject(new Error("Cannot start a connection that is not in the 'Disconnected' state.")):(this.connectionState=0,this.startPromise=this.startInternal(a),this.startPromise)},a.prototype.send=function(a){if(1!==this.connectionState)throw new Error("Cannot send data if the connection is not in the 'Connected' State.");return this.transport.send(a)},a.prototype.stop=function(a){return y.__awaiter(this,void 0,void 0,function(){var b;return y.__generator(this,function(c){switch(c.label){case 0:this.connectionState=2,c.label=1;case 1:return c.trys.push([1,3,,4]),[4,this.startPromise];case 2:return c.sent(),[3,4];case 3:return b=c.sent(),[3,4];case 4:return this.transport?(this.stopError=a,[4,this.transport.stop()]):[3,6];case 5:c.sent(),this.transport=null,c.label=6;case 6:return[2]}})})},a.prototype.startInternal=function(a){return y.__awaiter(this,void 0,void 0,function(){var b,c,e,f,g,h,i,j=this;return y.__generator(this,function(k){switch(k.label){case 0:b=this.baseUrl,this.accessTokenFactory=this.options.accessTokenFactory,k.label=1;case 1:return k.trys.push([1,12,,13]),this.options.skipNegotiation?this.options.transport!==I.HttpTransportType.WebSockets?[3,3]:(this.transport=this.constructTransport(I.HttpTransportType.WebSockets),[4,this.transport.connect(b,a)]):[3,5];case 2:return k.sent(),[3,4];case 3:throw Error("Negotiation can only be skipped when using the WebSocket transport directly.");case 4:return[3,11];case 5:c=null,e=0,f=function(){var a;return y.__generator(this,function(d){switch(d.label){case 0:return[4,g.getNegotiationResponse(b)];case 1:return c=d.sent(),2===g.connectionState?[2,{value:void 0}]:(c.url&&(b=c.url),c.accessToken&&(a=c.accessToken,g.accessTokenFactory=function(){return a}),e++,[2])}})},g=this,k.label=6;case 6:return[5,f()];case 7:if(h=k.sent(),"object"==typeof h)return[2,h.value];k.label=8;case 8:if(c.url&&e<d)return[3,6];k.label=9;case 9:if(e===d&&c.url)throw Error("Negotiate redirection limit exceeded.");return[4,this.createTransport(b,this.options.transport,c,a)];case 10:k.sent(),k.label=11;case 11:return this.transport instanceof K.LongPollingTransport&&(this.features.inherentKeepAlive=!0),this.transport.onreceive=this.onreceive,this.transport.onclose=function(a){return j.stopConnection(a)},this.changeState(0,1),[3,13];case 12:throw i=k.sent(),this.logger.log(A.LogLevel.Error,"Failed to start the connection: "+i),this.connectionState=2,this.transport=null,i;case 13:return[2]}})})},a.prototype.getNegotiationResponse=function(a){return y.__awaiter(this,void 0,void 0,function(){var b,c,d,e,f,g;return y.__generator(this,function(h){switch(h.label){case 0:return[4,this.accessTokenFactory()];case 1:b=h.sent(),b&&(g={},g.Authorization="Bearer "+b,c=g),d=this.resolveNegotiateUrl(a),this.logger.log(A.LogLevel.Debug,"Sending negotiation request: "+d),h.label=2;case 2:return h.trys.push([2,4,,5]),[4,this.httpClient.post(d,{content:"",headers:c})];case 3:if(e=h.sent(),200!==e.statusCode)throw Error("Unexpected status code returned from negotiate "+e.statusCode);return[2,JSON.parse(e.content)];case 4:throw f=h.sent(),this.logger.log(A.LogLevel.Error,"Failed to complete negotiation with the server: "+f),f;case 5:return[2]}})})},a.prototype.createConnectUrl=function(a,b){return a+(a.indexOf("?")===-1?"?":"&")+("id="+b)},a.prototype.createTransport=function(a,b,c,d){return y.__awaiter(this,void 0,void 0,function(){var e,f,g,h,i,j,k;return y.__generator(this,function(l){switch(l.label){case 0:return e=this.createConnectUrl(a,c.connectionId),this.isITransport(b)?(this.logger.log(A.LogLevel.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=b,[4,this.transport.connect(e,d)]):[3,2];case 1:return l.sent(),this.changeState(0,1),[2];case 2:f=c.availableTransports,g=0,h=f,l.label=3;case 3:return g<h.length?(i=h[g],this.connectionState=0,j=this.resolveTransport(i,b,d),"number"!=typeof j?[3,8]:(this.transport=this.constructTransport(j),null!==c.connectionId?[3,5]:[4,this.getNegotiationResponse(a)])):[3,9];case 4:c=l.sent(),e=this.createConnectUrl(a,c.connectionId),l.label=5;case 5:return l.trys.push([5,7,,8]),[4,this.transport.connect(e,d)];case 6:return l.sent(),this.changeState(0,1),[2];case 7:return k=l.sent(),this.logger.log(A.LogLevel.Error,"Failed to start the transport '"+I.HttpTransportType[j]+"': "+k),this.connectionState=2,c.connectionId=null,[3,8];case 8:return g++,[3,3];case 9:throw new Error("Unable to initialize any of the available transports.")}})})},a.prototype.constructTransport=function(a){switch(a){case I.HttpTransportType.WebSockets:return new M.WebSocketTransport(this.accessTokenFactory,this.logger,this.options.logMessageContent);case I.HttpTransportType.ServerSentEvents:return new L.ServerSentEventsTransport(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent);case I.HttpTransportType.LongPolling:return new K.LongPollingTransport(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent);default:throw new Error("Unknown transport: "+a+".")}},a.prototype.resolveTransport=function(a,b,d){var e=I.HttpTransportType[a.transport];if(null===e||void 0===e)this.logger.log(A.LogLevel.Debug,"Skipping transport '"+a.transport+"' because it is not supported by this client.");else{var f=a.transferFormats.map(function(a){return I.TransferFormat[a]});if(c(b,e))if(f.indexOf(d)>=0){if(!(e===I.HttpTransportType.WebSockets&&"undefined"==typeof WebSocket||e===I.HttpTransportType.ServerSentEvents&&"undefined"==typeof EventSource))return this.logger.log(A.LogLevel.Debug,"Selecting transport '"+I.HttpTransportType[e]+"'"),e;this.logger.log(A.LogLevel.Debug,"Skipping transport '"+I.HttpTransportType[e]+"' because it is not supported in your environment.'")}else this.logger.log(A.LogLevel.Debug,"Skipping transport '"+I.HttpTransportType[e]+"' because it does not support the requested transfer format '"+I.TransferFormat[d]+"'.");else this.logger.log(A.LogLevel.Debug,"Skipping transport '"+I.HttpTransportType[e]+"' because it was disabled by the client.")}return null},a.prototype.isITransport=function(a){return a&&"object"==typeof a&&"connect"in a},a.prototype.changeState=function(a,b){return this.connectionState===a&&(this.connectionState=b,!0)},a.prototype.stopConnection=function(a){return y.__awaiter(this,void 0,void 0,function(){return y.__generator(this,function(b){return this.transport=null,a=this.stopError||a,a?this.logger.log(A.LogLevel.Error,"Connection disconnected with error '"+a+"'."):this.logger.log(A.LogLevel.Information,"Connection disconnected."),this.connectionState=2,this.onclose&&this.onclose(a),[2]})})},a.prototype.resolveUrl=function(a){if(0===a.lastIndexOf("https://",0)||0===a.lastIndexOf("http://",0))return a;if("undefined"==typeof window||!window||!window.document)throw new Error("Cannot resolve '"+a+"'.");var b=window.document.createElement("a");return b.href=a,this.logger.log(A.LogLevel.Information,"Normalizing '"+a+"' to '"+b.href+"'."),b.href},a.prototype.resolveNegotiateUrl=function(a){var b=a.indexOf("?"),c=a.substring(0,b===-1?a.length:b);return"/"!==c[c.length-1]&&(c+="/"),c+="negotiate",c+=b===-1?"":a.substring(b)},a}();b.HttpConnection=e}));b(N);var O=(N.HttpConnection,c(function(a,b){Object.defineProperty(b,"__esModule",{value:!0});var c="json",d=function(){function a(){this.name=c,this.version=1,this.transferFormat=I.TransferFormat.Text}return a.prototype.parseMessages=function(a,b){if("string"!=typeof a)throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!a)return[];null===b&&(b=F.NullLogger.instance);for(var c=C.TextMessageFormat.parse(a),d=[],e=0,f=c;e<f.length;e++){var g=f[e],h=JSON.parse(g);if("number"!=typeof h.type)throw new Error("Invalid payload.");switch(h.type){case E.MessageType.Invocation:this.isInvocationMessage(h);break;case E.MessageType.StreamItem:this.isStreamItemMessage(h);break;case E.MessageType.Completion:this.isCompletionMessage(h);break;case E.MessageType.Ping:break;case E.MessageType.Close:break;default:b.log(A.LogLevel.Information,"Unknown message type '"+h.type+"' ignored.");continue}d.push(h)}return d},a.prototype.writeMessage=function(a){return C.TextMessageFormat.write(JSON.stringify(a))},a.prototype.isInvocationMessage=function(a){this.assertNotEmptyString(a.target,"Invalid payload for Invocation message."),void 0!==a.invocationId&&this.assertNotEmptyString(a.invocationId,"Invalid payload for Invocation message.")},a.prototype.isStreamItemMessage=function(a){if(this.assertNotEmptyString(a.invocationId,"Invalid payload for StreamItem message."),void 0===a.item)throw new Error("Invalid payload for StreamItem message.")},a.prototype.isCompletionMessage=function(a){if(a.result&&a.error)throw new Error("Invalid payload for Completion message.");!a.result&&a.error&&this.assertNotEmptyString(a.error,"Invalid payload for Completion message."),this.assertNotEmptyString(a.invocationId,"Invalid payload for Completion message.")},a.prototype.assertNotEmptyString=function(a,b){if("string"!=typeof a||""===a)throw new Error(b)},a}();b.JsonHubProtocol=d}));b(O);var P=(O.JsonHubProtocol,c(function(a,b){function c(a){return void 0!==a.log}Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(){}return a.prototype.configureLogging=function(a){return G.Arg.isRequired(a,"logging"),c(a)?this.logger=a:this.logger=new G.ConsoleLogger(a),this},a.prototype.withUrl=function(a,b){return G.Arg.isRequired(a,"url"),this.url=a,"object"==typeof b?this.httpConnectionOptions=b:this.httpConnectionOptions={transport:b},this},a.prototype.withHubProtocol=function(a){return G.Arg.isRequired(a,"protocol"),this.protocol=a,this},a.prototype.build=function(){var a=this.httpConnectionOptions||{};if(void 0===a.logger&&(a.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");var b=new N.HttpConnection(this.url,a);return H.HubConnection.create(b,this.logger||F.NullLogger.instance,this.protocol||new O.JsonHubProtocol)},a}();b.HubConnectionBuilder=d}));b(P);var Q=(P.HubConnectionBuilder,c(function(a,b){Object.defineProperty(b,"__esModule",{value:!0}),b.VERSION="0.0.0-DEV_BUILD",b.HttpError=z.HttpError,b.TimeoutError=z.TimeoutError,b.DefaultHttpClient=B.DefaultHttpClient,b.HttpClient=B.HttpClient,b.HttpResponse=B.HttpResponse,b.HubConnection=H.HubConnection,b.HubConnectionBuilder=P.HubConnectionBuilder,b.MessageType=E.MessageType,b.LogLevel=A.LogLevel,b.HttpTransportType=I.HttpTransportType,b.TransferFormat=I.TransferFormat,b.NullLogger=F.NullLogger,b.JsonHubProtocol=O.JsonHubProtocol}));b(Q);var R=(Q.VERSION,Q.HttpError,Q.TimeoutError,Q.DefaultHttpClient,Q.HttpClient,Q.HttpResponse,Q.HubConnection,Q.HubConnectionBuilder,Q.MessageType,Q.LogLevel,Q.HttpTransportType,Q.TransferFormat,Q.NullLogger,Q.JsonHubProtocol,c(function(a,b){Object.defineProperty(b,"__esModule",{value:!0}),Uint8Array.prototype.indexOf||Object.defineProperty(Uint8Array.prototype,"indexOf",{value:Array.prototype.indexOf,writable:!0}),Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:Array.prototype.slice,writable:!0}),Uint8Array.prototype.forEach||Object.defineProperty(Uint8Array.prototype,"forEach",{value:Array.prototype.forEach,writable:!0}),y.__exportStar(Q,b)})),S=b(R);return S});