!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.signalR=b()}(this,function(){"use strict";function a(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function b(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function c(a,b){return b={exports:{}},a(b,b.exports),b.exports}var d="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},e=(c(function(b,c){!function(a,c){b.exports=c()}(d,function(){function b(a){var b=typeof a;return null!==a&&("object"===b||"function"===b)}function c(a){return"function"==typeof a}function e(a){U=a}function f(a){V=a}function g(){return function(){return process.nextTick(l)}}function h(){return"undefined"!=typeof T?function(){T(l)}:k()}function i(){var a=0,b=new Y(l),c=document.createTextNode("");return b.observe(c,{characterData:!0}),function(){c.data=a=++a%2}}function j(){var a=new MessageChannel;return a.port1.onmessage=l,function(){return a.port2.postMessage(0)}}function k(){var a=setTimeout;return function(){return a(l,1)}}function l(){for(var a=0;a<S;a+=2){var b=_[a],c=_[a+1];b(c),_[a]=void 0,_[a+1]=void 0}S=0}function m(){try{var b=a,c=b("vertx");return T=c.runOnLoop||c.runOnContext,h()}catch(a){return k()}}function n(a,b){var c=this,d=new this.constructor(p);void 0===d[ba]&&I(d);var e=c._state;if(e){var f=arguments[e-1];V(function(){return F(e,d,f,c._result)})}else B(c,d,a,b);return d}function o(a){var b=this;if(a&&"object"==typeof a&&a.constructor===b)return a;var c=new b(p);return x(c,a),c}function p(){}function q(){return new TypeError("You cannot resolve a promise with itself")}function r(){return new TypeError("A promises callback cannot return that same promise.")}function s(a){try{return a.then}catch(a){return fa.error=a,fa}}function t(a,b,c,d){try{a.call(b,c,d)}catch(a){return a}}function u(a,b,c){V(function(a){var d=!1,e=t(c,b,function(c){d||(d=!0,b!==c?x(a,c):z(a,c))},function(b){d||(d=!0,A(a,b))},"Settle: "+(a._label||" unknown promise"));!d&&e&&(d=!0,A(a,e))},a)}function v(a,b){b._state===da?z(a,b._result):b._state===ea?A(a,b._result):B(b,void 0,function(b){return x(a,b)},function(b){return A(a,b)})}function w(a,b,d){b.constructor===a.constructor&&d===n&&b.constructor.resolve===o?v(a,b):d===fa?(A(a,fa.error),fa.error=null):void 0===d?z(a,b):c(d)?u(a,b,d):z(a,b)}function x(a,c){a===c?A(a,q()):b(c)?w(a,c,s(c)):z(a,c)}function y(a){a._onerror&&a._onerror(a._result),C(a)}function z(a,b){a._state===ca&&(a._result=b,a._state=da,0!==a._subscribers.length&&V(C,a))}function A(a,b){a._state===ca&&(a._state=ea,a._result=b,V(y,a))}function B(a,b,c,d){var e=a._subscribers,f=e.length;a._onerror=null,e[f]=b,e[f+da]=c,e[f+ea]=d,0===f&&a._state&&V(C,a)}function C(a){var b=a._subscribers,c=a._state;if(0!==b.length){for(var d=void 0,e=void 0,f=a._result,g=0;g<b.length;g+=3)d=b[g],e=b[g+c],d?F(c,d,e,f):e(f);a._subscribers.length=0}}function D(){this.error=null}function E(a,b){try{return a(b)}catch(a){return ga.error=a,ga}}function F(a,b,d,e){var f=c(d),g=void 0,h=void 0,i=void 0,j=void 0;if(f){if(g=E(d,e),g===ga?(j=!0,h=g.error,g.error=null):i=!0,b===g)return void A(b,r())}else g=e,i=!0;b._state!==ca||(f&&i?x(b,g):j?A(b,h):a===da?z(b,g):a===ea&&A(b,g))}function G(a,b){try{b(function(b){x(a,b)},function(b){A(a,b)})}catch(b){A(a,b)}}function H(){return ha++}function I(a){a[ba]=ha++,a._state=void 0,a._result=void 0,a._subscribers=[]}function J(){return new Error("Array Methods must be provided an Array")}function J(){return new Error("Array Methods must be provided an Array")}function K(a){return new ia(this,a).promise}function L(a){var b=this;return new b(R(a)?function(c,d){for(var e=a.length,f=0;f<e;f++)b.resolve(a[f]).then(c,d)}:function(a,b){return b(new TypeError("You must pass an array to race."))})}function M(a){var b=this,c=new b(p);return A(c,a),c}function N(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function O(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function P(){var a=void 0;if("undefined"!=typeof d)a=d;else if("undefined"!=typeof self)a=self;else try{a=Function("return this")()}catch(a){throw new Error("polyfill failed because global object is unavailable in this environment")}var b=a.Promise;if(b){var c=null;try{c=Object.prototype.toString.call(b.resolve())}catch(a){}if("[object Promise]"===c&&!b.cast)return}a.Promise=ja}var Q=void 0;Q=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)};var R=Q,S=0,T=void 0,U=void 0,V=function(a,b){_[S]=a,_[S+1]=b,S+=2,2===S&&(U?U(l):aa())},W="undefined"!=typeof window?window:void 0,X=W||{},Y=X.MutationObserver||X.WebKitMutationObserver,Z="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),$="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,_=new Array(1e3),aa=void 0;aa=Z?g():Y?i():$?j():void 0===W&&"function"==typeof a?m():k();var ba=Math.random().toString(36).substring(16),ca=void 0,da=1,ea=2,fa=new D,ga=new D,ha=0,ia=function(){function a(a,b){this._instanceConstructor=a,this.promise=new a(p),this.promise[ba]||I(this.promise),R(b)?(this.length=b.length,this._remaining=b.length,this._result=new Array(this.length),0===this.length?z(this.promise,this._result):(this.length=this.length||0,this._enumerate(b),0===this._remaining&&z(this.promise,this._result))):A(this.promise,J())}return a.prototype._enumerate=function(a){for(var b=0;this._state===ca&&b<a.length;b++)this._eachEntry(a[b],b)},a.prototype._eachEntry=function(a,b){var c=this._instanceConstructor,d=c.resolve;if(d===o){var e=s(a);if(e===n&&a._state!==ca)this._settledAt(a._state,b,a._result);else if("function"!=typeof e)this._remaining--,this._result[b]=a;else if(c===ja){var f=new c(p);w(f,a,e),this._willSettleAt(f,b)}else this._willSettleAt(new c(function(b){return b(a)}),b)}else this._willSettleAt(d(a),b)},a.prototype._settledAt=function(a,b,c){var d=this.promise;d._state===ca&&(this._remaining--,a===ea?A(d,c):this._result[b]=c),0===this._remaining&&z(d,this._result)},a.prototype._willSettleAt=function(a,b){var c=this;B(a,void 0,function(a){return c._settledAt(da,b,a)},function(a){return c._settledAt(ea,b,a)})},a}(),ja=function(){function a(b){this[ba]=H(),this._result=this._state=void 0,this._subscribers=[],p!==b&&("function"!=typeof b&&N(),this instanceof a?G(this,b):O())}return a.prototype.catch=function(a){return this.then(null,a)},a.prototype.finally=function(a){var b=this,c=b.constructor;return b.then(function(b){return c.resolve(a()).then(function(){return b})},function(b){return c.resolve(a()).then(function(){throw b})})},a}();return ja.prototype.then=n,ja.all=K,ja.race=L,ja.resolve=o,ja.reject=M,ja._setScheduler=e,ja._setAsap=f,ja._asap=V,ja.polyfill=P,ja.Promise=ja,ja.polyfill(),ja})}),c(function(a,b){var c=d&&d.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=function(a){function b(b,c){var d=a.call(this,b)||this;return d.statusCode=c,d}return c(b,a),b}(Error);b.HttpError=e;var f=function(a){function b(b){return void 0===b&&(b="A timeout occurred."),a.call(this,b)||this}return c(b,a),b}(Error);b.TimeoutError=f}));b(e);var f=(e.HttpError,e.TimeoutError,c(function(a,b){var c=d&&d.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),f=d&&d.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var g=function(){function a(a,b,c){this.statusCode=a,this.statusText=b,this.content=c}return a}();b.HttpResponse=g;var h=function(){function a(){}return a.prototype.get=function(a,b){return this.send(f({},b,{method:"GET",url:a}))},a.prototype.post=function(a,b){return this.send(f({},b,{method:"POST",url:a}))},a}();b.HttpClient=h;var i=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return c(b,a),b.prototype.send=function(a){return new Promise(function(b,c){var d=new XMLHttpRequest;d.open(a.method,a.url,!0),d.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.headers&&a.headers.forEach(function(a,b){return d.setRequestHeader(b,a)}),a.responseType&&(d.responseType=a.responseType),a.abortSignal&&(a.abortSignal.onabort=function(){d.abort()}),a.timeout&&(d.timeout=a.timeout),d.onload=function(){a.abortSignal&&(a.abortSignal.onabort=null),d.status>=200&&d.status<300?b(new g(d.status,d.statusText,d.response||d.responseText)):c(new e.HttpError(d.statusText,d.status))},d.onerror=function(){c(new e.HttpError(d.statusText,d.status))},d.ontimeout=function(){c(new e.TimeoutError)},d.send(a.content||"")})},b}(h);b.DefaultHttpClient=i}));b(f);var g=(f.HttpResponse,f.HttpClient,f.DefaultHttpClient,c(function(a,b){Object.defineProperty(b,"__esModule",{value:!0});var c;!function(a){a[a.Trace=0]="Trace",a[a.Information=1]="Information",a[a.Warning=2]="Warning",a[a.Error=3]="Error",a[a.None=4]="None"}(c=b.LogLevel||(b.LogLevel={}))}));b(g);var h=(g.LogLevel,c(function(a,b){Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(){this.isAborted=!1}return a.prototype.abort=function(){this.isAborted||(this.isAborted=!0,this.onabort&&this.onabort())},Object.defineProperty(a.prototype,"signal",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"aborted",{get:function(){return this.isAborted},enumerable:!0,configurable:!0}),a}();b.AbortController=c}));b(h);var i=(h.AbortController,c(function(a,b){function c(a,b,c,d){return f(this,void 0,void 0,function(){var e,f;return i(this,function(g){switch(g.label){case 0:return f=c(),f&&(e=new Map,e.set("Authorization","Bearer "+c())),[4,a.post(b,{content:d,headers:e})];case 1:return g.sent(),[2]}})})}var f=d&&d.__awaiter||function(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b||[])).next())})},i=d&&d.__generator||function(a,b){function c(a){return function(b){return d([a,b])}}function d(c){if(e)throw new TypeError("Generator is already executing.");for(;i;)try{if(e=1,f&&(g=f[2&c[0]?"return":c[0]?"throw":"next"])&&!(g=g.call(f,c[1])).done)return g;switch(f=0,g&&(c=[0,g.value]),c[0]){case 0:case 1:g=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,f=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(g=i.trys,!(g=g.length>0&&g[g.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!g||c[1]>g[0]&&c[1]<g[3])){i.label=c[1];break}if(6===c[0]&&i.label<g[1]){i.label=g[1],g=c;break}if(g&&i.label<g[2]){i.label=g[2],i.ops.push(c);break}g[2]&&i.ops.pop(),i.trys.pop();continue}c=b.call(a,i)}catch(a){c=[6,a],f=0}finally{e=g=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}var e,f,g,h,i={label:0,sent:function(){if(1&g[0])throw g[1];return g[1]},trys:[],ops:[]};return h={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h};Object.defineProperty(b,"__esModule",{value:!0});var j;!function(a){a[a.WebSockets=0]="WebSockets",a[a.ServerSentEvents=1]="ServerSentEvents",a[a.LongPolling=2]="LongPolling"}(j=b.TransportType||(b.TransportType={}));var k=function(){function a(a,b){this.logger=b,this.accessTokenFactory=a||function(){return null}}return a.prototype.connect=function(a,b,c){var d=this;return new Promise(function(c,e){a=a.replace(/^http/,"ws");var f=d.accessTokenFactory();f&&(a+=(a.indexOf("?")<0?"?":"&")+("access_token="+encodeURIComponent(f)));var h=new WebSocket(a);2==b&&(h.binaryType="arraybuffer"),h.onopen=function(e){d.logger.log(g.LogLevel.Information,"WebSocket connected to "+a),d.webSocket=h,c(b)},h.onerror=function(a){e()},h.onmessage=function(a){d.logger.log(g.LogLevel.Trace,"(WebSockets transport) data received: "+a.data),d.onreceive&&d.onreceive(a.data)},h.onclose=function(a){d.onclose&&d.webSocket&&(a.wasClean===!1||1e3!==a.code?d.onclose(new Error("Websocket closed with status code: "+a.code+" ("+a.reason+")")):d.onclose())}})},a.prototype.send=function(a){return this.webSocket&&this.webSocket.readyState===WebSocket.OPEN?(this.webSocket.send(a),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")},a.prototype.stop=function(){return this.webSocket&&(this.webSocket.close(),this.webSocket=null),Promise.resolve()},a}();b.WebSocketTransport=k;var l=function(){function a(a,b,c){this.httpClient=a,this.accessTokenFactory=b||function(){return null},this.logger=c}return a.prototype.connect=function(a,b,c){var d=this;return"undefined"==typeof EventSource&&Promise.reject("EventSource not supported by the browser."),this.url=a,new Promise(function(b,c){var e=d.accessTokenFactory();e&&(a+=(a.indexOf("?")<0?"?":"&")+("access_token="+encodeURIComponent(e)));var f=new EventSource(a);try{f.onmessage=function(a){if(d.onreceive)try{d.logger.log(g.LogLevel.Trace,"(SSE transport) data received: "+a.data),d.onreceive(a.data)}catch(a){return void(d.onclose&&d.onclose(a))}},f.onerror=function(a){c(),d.eventSource&&d.onclose&&d.onclose(new Error(a.message||"Error occurred"))},f.onopen=function(){d.logger.log(g.LogLevel.Information,"SSE connected to "+d.url),d.eventSource=f,b(1)}}catch(a){return Promise.reject(a)}})},a.prototype.send=function(a){return f(this,void 0,void 0,function(){return i(this,function(b){return[2,c(this.httpClient,this.url,this.accessTokenFactory,a)]})})},a.prototype.stop=function(){return this.eventSource&&(this.eventSource.close(),this.eventSource=null),Promise.resolve()},a}();b.ServerSentEventsTransport=l;var m=function(){function a(a,b,c){this.httpClient=a,this.accessTokenFactory=b||function(){return null},this.logger=c,this.pollAbort=new h.AbortController}return a.prototype.connect=function(a,b,c){if(this.url=a,c.features.inherentKeepAlive=!0,2===b&&"string"!=typeof(new XMLHttpRequest).responseType)throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");return this.poll(this.url,b),Promise.resolve(b)},a.prototype.poll=function(a,b){return f(this,void 0,void 0,function(){var c,d,f,h,j;return i(this,function(i){switch(i.label){case 0:c={timeout:12e4,abortSignal:this.pollAbort.signal,headers:new Map},2===b&&(c.responseType="arraybuffer"),d=this.accessTokenFactory(),d&&c.headers.set("Authorization","Bearer "+d),i.label=1;case 1:if(this.pollAbort.signal.aborted)return[3,6];i.label=2;case 2:return i.trys.push([2,4,,5]),f=a+"&_="+Date.now(),this.logger.log(g.LogLevel.Trace,"(LongPolling transport) polling: "+f),[4,this.httpClient.get(f,c)];case 3:return h=i.sent(),204===h.statusCode?(this.logger.log(g.LogLevel.Information,"(LongPolling transport) Poll terminated by server"),this.onclose&&this.onclose(),this.pollAbort.abort()):200!==h.statusCode?(this.logger.log(g.LogLevel.Error,"(LongPolling transport) Unexpected response code: "+h.statusCode),this.onclose&&this.onclose(new e.HttpError(h.statusText,h.statusCode)),this.pollAbort.abort()):h.content?(this.logger.log(g.LogLevel.Trace,"(LongPolling transport) data received: "+h.content),this.onreceive&&this.onreceive(h.content)):this.logger.log(g.LogLevel.Trace,"(LongPolling transport) Poll timed out, reissuing."),[3,5];case 4:return j=i.sent(),j instanceof e.TimeoutError?this.logger.log(g.LogLevel.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this.onclose&&this.onclose(j),this.pollAbort.abort()),[3,5];case 5:return[3,1];case 6:return[2]}})})},a.prototype.send=function(a){return f(this,void 0,void 0,function(){return i(this,function(b){return[2,c(this.httpClient,this.url,this.accessTokenFactory,a)]})})},a.prototype.stop=function(){return this.pollAbort.abort(),Promise.resolve()},a}();b.LongPollingTransport=m}));b(i);var j=(i.TransportType,i.WebSocketTransport,i.ServerSentEventsTransport,i.LongPollingTransport,c(function(a,b){Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(){}return a.prototype.log=function(a,b){},a}();b.NullLogger=c;var d=function(){function a(a){this.minimumLogLevel=a}return a.prototype.log=function(a,b){if(a>=this.minimumLogLevel)switch(a){case g.LogLevel.Error:console.error(g.LogLevel[a]+": "+b);break;case g.LogLevel.Warning:console.warn(g.LogLevel[a]+": "+b);break;case g.LogLevel.Information:console.info(g.LogLevel[a]+": "+b);break;default:console.log(g.LogLevel[a]+": "+b)}},a}();b.ConsoleLogger=d;var e;!function(a){function b(a){return void 0===a?new d(g.LogLevel.Information):null===a?new c:a.log?a:new d(a)}a.createLogger=b}(e=b.LoggerFactory||(b.LoggerFactory={}))}));b(j);var k=(j.NullLogger,j.ConsoleLogger,j.LoggerFactory,c(function(a,b){var c=d&&d.__awaiter||function(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b||[])).next())})},e=d&&d.__generator||function(a,b){function c(a){return function(b){return d([a,b])}}function d(c){if(e)throw new TypeError("Generator is already executing.");for(;i;)try{if(e=1,f&&(g=f[2&c[0]?"return":c[0]?"throw":"next"])&&!(g=g.call(f,c[1])).done)return g;switch(f=0,g&&(c=[0,g.value]),c[0]){case 0:case 1:g=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,f=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(g=i.trys,!(g=g.length>0&&g[g.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!g||c[1]>g[0]&&c[1]<g[3])){i.label=c[1];break}if(6===c[0]&&i.label<g[1]){i.label=g[1],g=c;break}if(g&&i.label<g[2]){i.label=g[2],i.ops.push(c);break}g[2]&&i.ops.pop(),i.trys.pop();continue}c=b.call(a,i)}catch(a){c=[6,a],f=0}finally{e=g=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}var e,f,g,h,i={label:0,sent:function(){if(1&g[0])throw g[1];return g[1]},trys:[],ops:[]};return h={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h};Object.defineProperty(b,"__esModule",{value:!0});var h=function(){function a(a,b){void 0===b&&(b={}),this.features={},this.logger=j.LoggerFactory.createLogger(b.logger),this.baseUrl=this.resolveUrl(a),b=b||{},b.accessTokenFactory=b.accessTokenFactory||function(){return null},this.httpClient=b.httpClient||new f.DefaultHttpClient,this.connectionState=2,this.options=b}return a.prototype.start=function(){return c(this,void 0,void 0,function(){return e(this,function(a){return 2!==this.connectionState?[2,Promise.reject(new Error("Cannot start a connection that is not in the 'Disconnected' state."))]:(this.connectionState=0,this.startPromise=this.startInternal(),[2,this.startPromise])})})},a.prototype.startInternal=function(){return c(this,void 0,void 0,function(){var a,b,c,d,f,h,j,k=this;return e(this,function(e){switch(e.label){case 0:return e.trys.push([0,5,,6]),this.options.transport!==i.TransportType.WebSockets?[3,1]:(this.url=this.baseUrl,this.transport=this.createTransport(this.options.transport,[i.TransportType[i.TransportType.WebSockets]]),[3,3]);case 1:return a=void 0,b=this.options.accessTokenFactory(),b&&(a=new Map,a.set("Authorization","Bearer "+b)),[4,this.httpClient.post(this.resolveNegotiateUrl(this.baseUrl),{content:"",headers:a})];case 2:if(c=e.sent(),d=JSON.parse(c.content),this.connectionId=d.connectionId,2==this.connectionState)return[2];this.connectionId&&(this.url=this.baseUrl+(this.baseUrl.indexOf("?")===-1?"?":"&")+("id="+this.connectionId),this.transport=this.createTransport(this.options.transport,d.availableTransports)),e.label=3;case 3:return this.transport.onreceive=this.onreceive,this.transport.onclose=function(a){return k.stopConnection(!0,a)},f=2===this.features.transferMode?2:1,h=this.features,[4,this.transport.connect(this.url,f,this)];case 4:return h.transferMode=e.sent(),this.changeState(0,1),[3,6];case 5:throw j=e.sent(),this.logger.log(g.LogLevel.Error,"Failed to start the connection. "+j),this.connectionState=2,this.transport=null,j;case 6:return[2]}})})},a.prototype.createTransport=function(a,b){if((null===a||void 0===a)&&b.length>0&&(a=i.TransportType[b[0]]),a===i.TransportType.WebSockets&&b.indexOf(i.TransportType[a])>=0)return new i.WebSocketTransport(this.options.accessTokenFactory,this.logger);if(a===i.TransportType.ServerSentEvents&&b.indexOf(i.TransportType[a])>=0)return new i.ServerSentEventsTransport(this.httpClient,this.options.accessTokenFactory,this.logger);if(a===i.TransportType.LongPolling&&b.indexOf(i.TransportType[a])>=0)return new i.LongPollingTransport(this.httpClient,this.options.accessTokenFactory,this.logger);if(this.isITransport(a))return a;throw new Error("No available transports found.")},a.prototype.isITransport=function(a){return"object"==typeof a&&"connect"in a},a.prototype.changeState=function(a,b){return this.connectionState==a&&(this.connectionState=b,!0)},a.prototype.send=function(a){if(1!=this.connectionState)throw new Error("Cannot send data if the connection is not in the 'Connected' State");return this.transport.send(a)},a.prototype.stop=function(a){return c(this,void 0,void 0,function(){var b,c;return e(this,function(d){switch(d.label){case 0:b=this.connectionState,this.connectionState=2,d.label=1;case 1:return d.trys.push([1,3,,4]),[4,this.startPromise];case 2:return d.sent(),[3,4];case 3:return c=d.sent(),[3,4];case 4:return this.stopConnection(1==b,a),[2]}})})},a.prototype.stopConnection=function(a,b){this.transport&&(this.transport.stop(),this.transport=null),b?this.logger.log(g.LogLevel.Error,"Connection disconnected with error '"+b+"'."):this.logger.log(g.LogLevel.Information,"Connection disconnected."),this.connectionState=2,a&&this.onclose&&this.onclose(b)},a.prototype.resolveUrl=function(a){if(0===a.lastIndexOf("https://",0)||0===a.lastIndexOf("http://",0))return a;if("undefined"==typeof window||!window||!window.document)throw new Error("Cannot resolve '"+a+"'.");var b=window.document.createElement("a");b.href=a;var c=b.protocol&&":"!==b.protocol?b.protocol+"//"+b.host:window.document.location.protocol+"//"+(b.host||window.document.location.host);a&&"/"==a[0]||(a="/"+a);var d=c+a;return this.logger.log(g.LogLevel.Information,"Normalizing '"+a+"' to '"+d+"'"),d},a.prototype.resolveNegotiateUrl=function(a){var b=a.indexOf("?"),c=a.substring(0,b===-1?a.length:b);return"/"!==c[c.length-1]&&(c+="/"),c+="negotiate",c+=b===-1?"":a.substring(b)},a}();b.HttpConnection=h}));b(k);var l=(k.HttpConnection,c(function(a,b){Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(a,b){this.subject=a,this.observer=b}return a.prototype.dispose=function(){var a=this.subject.observers.indexOf(this.observer);a>-1&&this.subject.observers.splice(a,1),0===this.subject.observers.length&&this.subject.cancelCallback().catch(function(a){})},a}();b.Subscription=c;var d=function(){function a(a){this.observers=[],this.cancelCallback=a}return a.prototype.next=function(a){for(var b=0,c=this.observers;b<c.length;b++){var d=c[b];d.next(a)}},a.prototype.error=function(a){for(var b=0,c=this.observers;b<c.length;b++){var d=c[b];d.error&&d.error(a)}},a.prototype.complete=function(){for(var a=0,b=this.observers;a<b.length;a++){var c=b[a];c.complete&&c.complete()}},a.prototype.subscribe=function(a){return this.observers.push(a),new c(this,a)},a}();b.Subject=d}));b(l);var m=(l.Subscription,l.Subject,c(function(a,b){Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(){}return a.write=function(b){return""+b+a.RecordSeparator},a.parse=function(b){if(b[b.length-1]!=a.RecordSeparator)throw new Error("Message is incomplete.");var c=b.split(a.RecordSeparator);return c.pop(),c},a.RecordSeparator=String.fromCharCode(30),a}();b.TextMessageFormat=c}));b(m);var n=(m.TextMessageFormat,c(function(a,b){Object.defineProperty(b,"__esModule",{value:!0}),b.JSON_HUB_PROTOCOL_NAME="json";var c=function(){function a(){this.name=b.JSON_HUB_PROTOCOL_NAME,this.type=1}return a.prototype.parseMessages=function(a){if(!a)return[];for(var b=m.TextMessageFormat.parse(a),c=[],d=0;d<b.length;++d)c.push(JSON.parse(b[d]));return c},a.prototype.writeMessage=function(a){return m.TextMessageFormat.write(JSON.stringify(a))},a}();b.JsonHubProtocol=c}));b(n);var o=(n.JSON_HUB_PROTOCOL_NAME,n.JsonHubProtocol,c(function(a,b){Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(a){this.wrappedProtocol=a,this.name=this.wrappedProtocol.name,this.type=1}return a.prototype.parseMessages=function(a){var b=a.indexOf(":");if(b==-1||";"!=a[a.length-1])throw new Error("Invalid payload.");var c=a.substring(0,b);if(!/^[0-9]+$/.test(c))throw new Error("Invalid length: '"+c+"'");var d=parseInt(c,10);if(d!=a.length-b-2)throw new Error("Invalid message size.");for(var e=a.substring(b+1,a.length-1),f=atob(e),g=new Uint8Array(f.length),h=0;h<g.length;h++)g[h]=f.charCodeAt(h);return this.wrappedProtocol.parseMessages(g.buffer)},a.prototype.writeMessage=function(a){for(var b=new Uint8Array(this.wrappedProtocol.writeMessage(a)),c="",d=0;d<b.byteLength;d++)c+=String.fromCharCode(b[d]);var e=btoa(c);return e.length.toString()+":"+e+";"},a}();b.Base64EncodedHubProtocol=c}));b(o);var p=(o.Base64EncodedHubProtocol,c(function(a,b){var c=d&&d.__awaiter||function(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b||[])).next())})},e=d&&d.__generator||function(a,b){function c(a){return function(b){return d([a,b])}}function d(c){if(e)throw new TypeError("Generator is already executing.");for(;i;)try{if(e=1,f&&(g=f[2&c[0]?"return":c[0]?"throw":"next"])&&!(g=g.call(f,c[1])).done)return g;switch(f=0,g&&(c=[0,g.value]),c[0]){case 0:case 1:g=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,f=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(g=i.trys,!(g=g.length>0&&g[g.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!g||c[1]>g[0]&&c[1]<g[3])){i.label=c[1];break}if(6===c[0]&&i.label<g[1]){i.label=g[1],g=c;break}if(g&&i.label<g[2]){i.label=g[2],i.ops.push(c);break}g[2]&&i.ops.pop(),i.trys.pop();continue}c=b.call(a,i)}catch(a){c=[6,a],f=0}finally{e=g=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}var e,f,g,h,i={label:0,sent:function(){if(1&g[0])throw g[1];return g[1]},trys:[],ops:[]};return h={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h};Object.defineProperty(b,"__esModule",{value:!0}),b.JsonHubProtocol=n.JsonHubProtocol;var f=3e4,h=function(){function a(a,b){void 0===b&&(b={});var c=this;b=b||{},this.timeoutInMilliseconds=b.timeoutInMilliseconds||f,"string"==typeof a?this.connection=new k.HttpConnection(a,b):this.connection=a,this.logger=j.LoggerFactory.createLogger(b.logger),this.protocol=b.protocol||new n.JsonHubProtocol,this.connection.onreceive=function(a){return c.processIncomingData(a)},this.connection.onclose=function(a){return c.connectionClosed(a)},this.callbacks=new Map,this.methods=new Map,this.closedCallbacks=[],this.id=0}return a.prototype.processIncomingData=function(a){void 0!==this.timeoutHandle&&clearTimeout(this.timeoutHandle);for(var b=this.protocol.parseMessages(a),c=0;c<b.length;++c){var d=b[c];switch(d.type){case 1:this.invokeClientMethod(d);break;case 2:case 3:var e=this.callbacks.get(d.invocationId);null!=e&&(3===d.type&&this.callbacks.delete(d.invocationId),e(d));break;case 6:break;default:this.logger.log(g.LogLevel.Warning,"Invalid message type: "+a)}}this.configureTimeout()},a.prototype.configureTimeout=function(){var a=this;this.connection.features&&this.connection.features.inherentKeepAlive||(this.timeoutHandle=setTimeout(function(){return a.serverTimeout()},this.timeoutInMilliseconds))},a.prototype.serverTimeout=function(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))},a.prototype.invokeClientMethod=function(a){var b=this,c=this.methods.get(a.target.toLowerCase());if(c){if(c.forEach(function(c){return c.apply(b,a.arguments)}),a.invocationId){var d="Server requested a response, which is not supported in this version of the client.";this.logger.log(g.LogLevel.Error,d),this.connection.stop(new Error(d))}}else this.logger.log(g.LogLevel.Warning,"No client method with the name '"+a.target+"' found.")},a.prototype.connectionClosed=function(a){var b=this;this.callbacks.forEach(function(b){b(void 0,a?a:new Error("Invocation canceled due to connection being closed."))}),this.callbacks.clear(),this.closedCallbacks.forEach(function(c){return c.apply(b,[a])}),this.cleanupTimeout()},a.prototype.start=function(){return c(this,void 0,void 0,function(){var a,b;return e(this,function(c){switch(c.label){case 0:return a=2===this.protocol.type?2:1,this.connection.features.transferMode=a,[4,this.connection.start()];case 1:return c.sent(),b=this.connection.features.transferMode,[4,this.connection.send(m.TextMessageFormat.write(JSON.stringify({protocol:this.protocol.name})))];case 2:return c.sent(),this.logger.log(g.LogLevel.Information,"Using HubProtocol '"+this.protocol.name+"'."),2===a&&1===b&&(this.protocol=new o.Base64EncodedHubProtocol(this.protocol)),this.configureTimeout(),[2]}})})},a.prototype.stop=function(){return this.cleanupTimeout(),this.connection.stop()},a.prototype.stream=function(a){for(var b=this,c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];var e=this.createStreamInvocation(a,c),f=new l.Subject(function(){var a=b.createCancelInvocation(e.invocationId),c=b.protocol.writeMessage(a);return b.callbacks.delete(e.invocationId),b.connection.send(c)});this.callbacks.set(e.invocationId,function(a,b){if(b)return void f.error(b);if(3===a.type){var c=a;c.error?f.error(new Error(c.error)):f.complete()}else f.next(a.item)});var g=this.protocol.writeMessage(e);return this.connection.send(g).catch(function(a){f.error(a),b.callbacks.delete(e.invocationId)}),f},a.prototype.send=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];var d=this.createInvocation(a,b,!0),e=this.protocol.writeMessage(d);return this.connection.send(e)},a.prototype.invoke=function(a){for(var b=this,c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];var e=this.createInvocation(a,c,!1),f=new Promise(function(a,c){b.callbacks.set(e.invocationId,function(b,d){if(d)return void c(d);if(3===b.type){var e=b;e.error?c(new Error(e.error)):a(e.result)}else c(new Error("Unexpected message type: "+b.type))});var d=b.protocol.writeMessage(e);b.connection.send(d).catch(function(a){c(a),b.callbacks.delete(e.invocationId)})});return f},a.prototype.on=function(a,b){a&&b&&(a=a.toLowerCase(),this.methods.has(a)||this.methods.set(a,[]),this.methods.get(a).push(b))},a.prototype.off=function(a,b){if(a&&b){a=a.toLowerCase();var c=this.methods.get(a);if(c){var d=c.indexOf(b);d!=-1&&c.splice(d,1)}}},a.prototype.onclose=function(a){a&&this.closedCallbacks.push(a)},a.prototype.cleanupTimeout=function(){this.timeoutHandle&&clearTimeout(this.timeoutHandle)},a.prototype.createInvocation=function(a,b,c){if(c)return{
type:1,target:a,arguments:b};var d=this.id;return this.id++,{type:1,invocationId:d.toString(),target:a,arguments:b}},a.prototype.createStreamInvocation=function(a,b){var c=this.id;return this.id++,{type:4,invocationId:c.toString(),target:a,arguments:b}},a.prototype.createCancelInvocation=function(a){return{type:5,invocationId:a}},a}();b.HubConnection=h}));b(p);var q=(p.JsonHubProtocol,p.HubConnection,c(function(a,b){Object.defineProperty(b,"__esModule",{value:!0})}));b(q);var r=c(function(a,b){function c(a){for(var c in a)b.hasOwnProperty(c)||(b[c]=a[c])}Object.defineProperty(b,"__esModule",{value:!0}),c(e),c(f),c(k),c(p),c(q),c(g),c(j),c(i),c(l)});b(r);var s=c(function(a,b){function c(a){for(var c in a)b.hasOwnProperty(c)||(b[c]=a[c])}Object.defineProperty(b,"__esModule",{value:!0}),c(r)}),t=b(s);return t});