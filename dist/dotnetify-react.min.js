var dotnetifyHub="undefined"==typeof dotnetifyHub?{}:dotnetifyHub;!function(a){var b=window||global;if("object"==typeof exports&&"object"==typeof module){var c=window?window.jQuery||require("./jquery-shim"):require("./jquery-shim"),d=window?window.signalR||require("./signalR-netcore"):require("./signalR-netcore");module.exports=a(c,d,b)}else"function"==typeof define&&define.amd?define(["jquery","signalR"],a):a(jQuery,d,b)}(function(a,b,c){return dotnetifyHub=a.extend(dotnetifyHub,{version:"1.1.0-beta",type:null,_init:!1}),dotnetifyHub.init=function(d,e,f){dotnetifyHub._init||(dotnetifyHub._init=!0,f=f||b,f&&f.HubConnection?(dotnetifyHub.type="netcore",Object.defineProperty(dotnetifyHub,"isConnected",{get:function(){return dotnetifyHub._connection&&2===dotnetifyHub._connection.connection.connectionState}}),dotnetifyHub=a.extend(dotnetifyHub,{hubPath:d||"/dotnetify",url:e,reconnectDelay:[2,5,10],reconnectRetry:null,_connection:null,_reconnectCount:0,_startDoneHandler:null,_startFailHandler:null,_disconnectedHandler:function(){},_stateChangedHandler:function(a){},_onDisconnected:function(){dotnetifyHub._changeState(4),dotnetifyHub._disconnectedHandler()},_changeState:function(a){1==a&&(dotnetifyHub._reconnectCount=0);var b={0:"connecting",1:"connected",2:"reconnecting",4:"disconnected",99:"terminated"};dotnetifyHub._stateChangedHandler(b[a])},_startConnection:function(a,b){var c=dotnetifyHub.url?dotnetifyHub.url+dotnetifyHub.hubPath:dotnetifyHub.hubPath,d={};Object.keys(a).forEach(function(b){d[b]=a[b]}),d.transport=b.shift(),dotnetifyHub._connection=new f.HubConnection(c,d),dotnetifyHub._connection.on("response_vm",dotnetifyHub.client.response_VM),dotnetifyHub._connection.onclose(dotnetifyHub._onDisconnected);var e=dotnetifyHub._connection.start().then(function(){dotnetifyHub._changeState(1)}).catch(function(){b.length>0?dotnetifyHub._startConnection(a,b):dotnetifyHub._onDisconnected()});return"function"==typeof dotnetifyHub._startDoneHandler&&e.then(dotnetifyHub._startDoneHandler).catch(dotnetifyHub._startFailHandler||function(){}),e},start:function(a){dotnetifyHub._startDoneHandler=null,dotnetifyHub._startFailHandler=null;var b=[0],c={webSockets:0,serverSentEvents:1,longPolling:2};a&&Array.isArray(a.transport)&&(b=a.transport.map(function(a){return c[a]}));var d=dotnetifyHub._startConnection(a,b);return{done:function(a){return dotnetifyHub._startDoneHandler=a,d.then(a).catch(function(){}),this},fail:function(a){return dotnetifyHub._startFailHandler=a,d.catch(a),this}}},disconnected:function(a){"function"==typeof a&&(dotnetifyHub._disconnectedHandler=a)},stateChanged:function(a){"function"==typeof a&&(dotnetifyHub._stateChangedHandler=a)},reconnect:function(a){if("function"==typeof a)if(!dotnetifyHub.reconnectRetry||dotnetifyHub._reconnectCount<dotnetifyHub.reconnectRetry){var b=dotnetifyHub._reconnectCount<dotnetifyHub.reconnectDelay.length?dotnetifyHub.reconnectDelay[dotnetifyHub._reconnectCount]:dotnetifyHub.reconnectDelay[dotnetifyHub.reconnectDelay.length-1];dotnetifyHub._reconnectCount++,setTimeout(function(){dotnetifyHub._changeState(2),a()},1e3*b)}else dotnetifyHub._changeState(99)},client:{},server:{dispose_VM:function(a){dotnetifyHub._connection.invoke("Dispose_VM",a)},update_VM:function(a,b){dotnetifyHub._connection.invoke("Update_VM",a,b)},request_VM:function(a,b){dotnetifyHub._connection.invoke("Request_VM",a,b)}}})):(dotnetifyHub.type="netfx",function(a,b,c){"use strict";function d(b,c){return function(){c.apply(b,a.makeArray(arguments))}}function e(b,c){var e,f,g,h,i;for(e in b)if(b.hasOwnProperty(e)){if(f=b[e],!f.hubName)continue;i=c?f.on:f.off;for(g in f.client)if(f.client.hasOwnProperty(g)){if(h=f.client[g],!a.isFunction(h))continue;i.call(f,g,d(f,h))}}}if("function"!=typeof a.signalR)throw new Error("SignalR: SignalR is not loaded. Please ensure jquery.signalR-x.js is referenced before ~/signalr/js.");var f=a.signalR;a.hubConnection.prototype.createHubProxies=function(){var b={};return this.starting(function(){e(b,!0),this._registerSubscribedHubs()}).disconnected(function(){e(b,!1)}),b.dotNetifyHub=this.createHubProxy("dotNetifyHub"),b.dotNetifyHub.client={},b.dotNetifyHub.server={dispose_VM:function(c){return b.dotNetifyHub.invoke.apply(b.dotNetifyHub,a.merge(["Dispose_VM"],a.makeArray(arguments)))},request_VM:function(c,d){return b.dotNetifyHub.invoke.apply(b.dotNetifyHub,a.merge(["Request_VM"],a.makeArray(arguments)))},update_VM:function(c,d){return b.dotNetifyHub.invoke.apply(b.dotNetifyHub,a.merge(["Update_VM"],a.makeArray(arguments)))}},b},f.hub=a.hubConnection(dotnetifyHub.hubPath,{useDefaultPath:!1}),a.extend(f,f.hub.createHubProxies())}(a,c),Object.defineProperty(dotnetifyHub,"state",{get:function(){return a.connection.hub.state},set:function(b){a.connection.hub.state=b}}),Object.defineProperty(dotnetifyHub,"client",{get:function(){return a.connection.dotNetifyHub.client}}),Object.defineProperty(dotnetifyHub,"server",{get:function(){return a.connection.dotNetifyHub.server}}),Object.defineProperty(dotnetifyHub,"isConnected",{get:function(){return a.connection.hub.state==a.signalR.connectionState.connected}}),dotnetifyHub=a.extend(dotnetifyHub,{hubPath:d||"/signalr",url:e,reconnectDelay:[2,5,10],reconnectRetry:null,_reconnectCount:0,_stateChangedHandler:function(a){},start:function(b){dotnetifyHub.url&&(a.connection.hub.url=dotnetifyHub.url);var c;return c=b?a.connection.hub.start(b):a.connection.hub.start(),c.fail(function(a){a.source&&"Error parsing negotiate response."===a.source.message&&console.warn("This client may be attempting to connect to an incompatible SignalR .NET Core server.")}),c},disconnected:function(b){return a.connection.hub.disconnected(b)},stateChanged:function(b){return dotnetifyHub._stateChangedHandler=b,a.connection.hub.stateChanged(function(a){1==a&&(dotnetifyHub._reconnectCount=0);var c={0:"connecting",1:"connected",2:"reconnecting",4:"disconnected"};b(c[a.newState])})},reconnect:function(a){if("function"==typeof a)if(!dotnetifyHub.reconnectRetry||dotnetifyHub._reconnectCount<dotnetifyHub.reconnectRetry){var b=dotnetifyHub._reconnectCount<dotnetifyHub.reconnectDelay.length?dotnetifyHub.reconnectDelay[dotnetifyHub._reconnectCount]:dotnetifyHub.reconnectDelay[dotnetifyHub.reconnectDelay.length-1];dotnetifyHub._reconnectCount++,setTimeout(function(){dotnetifyHub._stateChangedHandler("reconnecting"),a()},1e3*b)}else dotnetifyHub._stateChangedHandler("terminated")}})))},dotnetifyHub});var dotnetify="undefined"==typeof dotnetify?{}:dotnetify;!function(a){var b=window||global;if("object"==typeof exports&&"object"==typeof module){var c="undefined"!=typeof window?window.jQuery||require("./jquery-shim"):require("./jquery-shim");module.exports=a(c,b,require("./dotnetify-hub"))}else"function"==typeof define&&define.amd?define(["./jquery-shim","./dotnetify-hub"],a):a(jQuery,b,dotnetifyHub)}(function(a,b,c){function d(b,c,d){this.$vmId=b,this.$component=c,this.$vmArg=d&&d.vmArg,this.$headers=d&&d.headers,this.$exceptionHandler=d&&d.exceptionHandler,this.$requested=!1,this.$loaded=!1,this.$itemKey={};var e=d&&d.getState,f=d&&d.setState;e="function"==typeof e?e:function(){return c.state},f="function"==typeof f?f:function(a){c.setState(a)},c&&c.props&&c.props.hasOwnProperty("vmArg")&&(this.$vmArg=a.extend(this.$vmArg,c.props.vmArg)),this.State=function(a){return"undefined"==typeof a?e():f(a)};for(var g in dotnetify.react.plugins){var h=dotnetify.react.plugins[g];h.hasOwnProperty("$inject")&&h.$inject(this)}}return dotnetify=a.extend(dotnetify,{hub:c,hubOptions:{transport:["webSockets","longPolling"]},hubPath:null,hubServerUrl:null,debug:!1,debugFn:null,connectionStateHandler:null,isConnected:function(){return c.isConnected},connect:function(a,b){return dotnetify.react.connect(a,null,b)},_triggerConnectionStateEvent:function(a,b){dotnetify.debug&&console.log("SignalR: "+(b?b.message:a)),"function"==typeof dotnetify.connectionStateHandler?dotnetify.connectionStateHandler(a,b):b&&console.error(b)},_hub:null}),dotnetify.react=a.extend(dotnetify.hasOwnProperty("react")?dotnetify.react:{},{version:"1.0.5-beta",viewModels:{},plugins:{},init:function(){var a=dotnetify.react;null===dotnetify._hub&&(c.init(dotnetify.hubPath,dotnetify.hubServerUrl,dotnetify.hubLib),c.client.response_VM=function(b,d){var e=a.viewModels.hasOwnProperty(b)?a.viewModels[b]:null,f=JSON.parse(d);if(f&&f.hasOwnProperty("ExceptionType")&&f.hasOwnProperty("Message")){var g={name:f.ExceptionType,message:f.Message};if(e&&"function"==typeof e.$exceptionHandler)return e.$exceptionHandler(g);throw console.error("["+b+"] "+g.name+": "+g.message),g}e?e.$update(d):c.server.dispose_VM(b)},c.disconnected(function(){dotnetify._hub=null,c.reconnect(a.startHub)}),c.stateChanged(function(a){dotnetify._triggerConnectionStateEvent(a)})),a.startHub()},startHub:function(){var a=dotnetify.react,b=function(){for(var b in a.viewModels)a.viewModels[b].$requested||a.viewModels[b].$request()};if(null===dotnetify._hub){for(var d in a.viewModels)a.viewModels[d].$requested=!1;dotnetify._hub=c.start(dotnetify.hubOptions).done(function(){b()}).fail(function(a){dotnetify._triggerConnectionStateEvent("error",a)})}else dotnetify.isConnected()&&dotnetify._hub.done(b);return dotnetify._hub},connect:function(a,b,c){if(arguments.length<2)throw new Error("[dotNetify] Missing arguments. Usage: connect(vmId, component) ");if(arguments.length>3)throw new Error("[dotNetify] Deprecated parameters. New usage: connect(vmId, component [,{getState, setState, vmArg, headers, exceptionHandler}]) ");if(dotnetify.ssr){var e=c&&c.vmArg;return dotnetify.react.ssrConnect(a,b,e)}var f=dotnetify.react;return f.viewModels.hasOwnProperty(a)?console.error("Component is attempting to connect to an already active '"+a+"'.  If it's from a dismounted component, you must add vm.$destroy to componentWillUnmount()."):f.viewModels[a]=new d(a,b,c),f.init(),f.viewModels[a]},ssrConnect:function(c,e,f){null!=b.ssr&&b.ssr.hasOwnProperty(c)||console.error("Server-side rendering requires initial state in 'window.ssr."+c+"'.");var g=dotnetify.react,h=b.ssr[c],i=function(){return h},j=function(b){h=a.extend(h,b)},k={getState:i,setState:j,vmArg:f},l=g.viewModels[c]=new d(c,e,k);return setTimeout(function(){l.$update(JSON.stringify(b.ssr[c]))},100),l},getViewModels:function(){var a=dotnetify.react,b=[];for(var c in a.viewModels)b.push(a.viewModels[c]);return b}}),d.prototype.$destroy=function(){for(var a in dotnetify.react.plugins){var b=dotnetify.react.plugins[a];"function"==typeof b.$destroy&&b.$destroy.apply(this)}if(dotnetify.isConnected())try{c.server.dispose_VM(this.$vmId)}catch(a){dotnetify._triggerConnectionStateEvent("error",a)}delete dotnetify.react.viewModels[this.$vmId]},d.prototype.$dispatch=function(a){if(dotnetify.isConnected())try{c.server.update_VM(this.$vmId,a),dotnetify.debug&&(console.log("["+this.$vmId+"] sent> "),console.log(a),null!=dotnetify.debugFn&&dotnetify.debugFn(this.$vmId,"sent",a))}catch(a){dotnetify._triggerConnectionStateEvent("error",a)}},d.prototype.$dispatchListState=function(a){for(var b in a){var c=this.$itemKey[b];if(!c)return void console.error("["+this.$vmId+"] missing item key for '"+b+"'; add "+b+"_itemKey property to the view model.");var d=a[b];if(!d[c])return console.error("["+this.$vmId+"] couldn't dispatch data from '"+b+"' due to missing property '"+c+"'"),void console.error(d);for(var e in d)if(e!=c){var f={};f[b+".$"+d[c]+"."+e]=d[e],this.$dispatch(f)}this.$updateList(b,d)}},d.prototype.$preProcess=function(a){var b=this;for(var c in a){var d=/(.*)_add/.exec(c);if(null==d){var d=/(.*)_update/.exec(c);if(null==d){var d=/(.*)_remove/.exec(c);if(null==d){var d=/(.*)_itemKey/.exec(c);if(null==d);else{var e=d[1],f={};f[e]=a[c],b.$setItemKey(f),delete a[c]}}else{var e=d[1];if(Array.isArray(this.State()[e])){var g=this.$itemKey[e];null!=g?b.$removeList(e,function(b){return b[g]==a[c]}):console.error("["+this.$vmId+"] missing item key for '"+e+"'; add "+e+"_itemKey property to the view model.")}else console.error("["+this.$vmId+"] '"+e+"' is not found or not an array.");delete a[c]}}else{var e=d[1];Array.isArray(this.State()[e])?b.$updateList(e,a[c]):console.error("["+this.$vmId+"] '"+e+"' is not found or not an array."),delete a[c]}}else{var e=d[1];Array.isArray(this.State()[e])?b.$addList(e,a[c]):console.error("unable to resolve "+c),delete a[c]}}},d.prototype.$request=function(){dotnetify.isConnected()&&(c.server.request_VM(this.$vmId,{$vmArg:this.$vmArg,$headers:this.$headers}),this.$requested=!0)},d.prototype.$update=function(b){dotnetify.debug&&(console.log("["+this.$vmId+"] received> "),console.log(JSON.parse(b)),null!=dotnetify.debugFn&&dotnetify.debugFn(this.$vmId,"received",JSON.parse(b)));var c=JSON.parse(b);this.$preProcess(c);var d=this.State();d=a.extend({},d,c),this.State(d),this.$loaded||this.$onLoad()},d.prototype.$onLoad=function(){for(var a in dotnetify.react.plugins){var b=dotnetify.react.plugins[a];"function"==typeof b.$ready&&b.$ready.apply(this)}this.$loaded=!0},d.prototype.$setItemKey=function(a){this.$itemKey=a},d.prototype.$addList=function(a,b){var c=this.$itemKey[a];if(null!=c){if(!b.hasOwnProperty(c))return void console.error("["+this.$vmId+"] couldn't add item to '"+a+"' due to missing property '"+c+"'");var d=this.State()[a].filter(function(a){return a[c]==b[c]});if(d.length>0)return void console.error("["+this.$vmId+"] couldn't add item to '"+listName+"' because the key already exists")}var e=this.State()[a];e.push(b);var f={};f[a]=e,this.State(f)},d.prototype.$removeList=function(a,b){var c={};c[a]=this.State()[a].filter(function(a){return!b(a)}),this.State(c)},d.prototype.$updateList=function(b,c){var d=this.$itemKey[b];if(null!=d){if(!c.hasOwnProperty(d))return void console.error("["+this.$vmId+"] couldn't update item to '"+b+"' due to missing property '"+d+"'");var e={};e[b]=this.State()[b].map(function(b){return b[d]==c[d]?a.extend(b,c):b}),this.State(e)}else console.error("["+this.$vmId+"] missing item key for '"+listName+"'; add "+listName+"_itemKey property to the view model.")},dotnetify}),function(a){if("object"==typeof exports&&"object"==typeof module){var b="undefined"!=typeof jQuery?jQuery:require("./jquery-shim");module.exports=a(require("react"),require("react-dom"),require("create-react-class"),b,require("dotnetify"))}else"function"==typeof define&&define.amd?define(["react","react-dom","create-react-class","./jquery-shim","dotnetify"],a):a(React,ReactDOM,createReactClass,jQuery,dotnetify)}(function(a,b,c,d,e){var f={version:"0.8.5",map:function(a){return f.routes.defined.hasOwnProperty(a)?f.routes.defined[a]:new f.core.route(a)},root:function(a){f.routes.root=a},rescue:function(a){f.routes.rescue=a},history:{initial:{},pushState:function(a,b,c){f.history.supported?f.dispatch(c)&&history.pushState(a,b,c):f.history.fallback&&(window.location.hash="#"+c)},popState:function(a){var b=!f.history.initial.popped&&location.href==f.history.initial.URL;f.history.initial.popped=!0,b||f.dispatch(document.location.pathname)},listen:function(a){if(f.history.supported=!(!window.history||!window.history.pushState),f.history.fallback=a,f.history.supported)f.history.initial.popped="state"in window.history,f.history.initial.URL=location.href,window.onpopstate=f.history.popState;else if(f.history.fallback){for(route in f.routes.defined)"#"!=route.charAt(0)&&(f.routes.defined["#"+route]=f.routes.defined[route],f.routes.defined["#"+route].path="#"+route);f.listen()}}},match:function(a,b){var c,d,e,g,h,i,j={},k=null;for(k in f.routes.defined)if(null!==k&&void 0!==k)for(k=f.routes.defined[k],c=k.partition(),g=0;g<c.length;g++){if(d=c[g],h=a,d.search(/:/)>0)for(e=0;e<d.split("/").length;e++)e<h.split("/").length&&":"===d.split("/")[e].charAt(0)&&(j[d.split("/")[e].replace(/:/,"")]=h.split("/")[e],i=h.split("/"),i[e]=d.split("/")[e],h=i.join("/"));if(d===h)return b&&(k.params=j),k}return null},dispatch:function(a){var b,c;if(f.routes.current!==a){if(f.routes.previous=f.routes.current,f.routes.current=a,c=f.match(a,!0),f.routes.previous&&(b=f.match(f.routes.previous),null!==b&&null!==b.do_exit&&b.do_exit()),null!==c)return c.run(),!0;null!==f.routes.rescue&&f.routes.rescue()}},listen:function(){var a=function(){f.dispatch(location.hash)};""===location.hash&&null!==f.routes.root&&(location.hash=f.routes.root),"onhashchange"in window&&(!document.documentMode||document.documentMode>=8)?window.onhashchange=a:setInterval(a,50),""!==location.hash&&f.dispatch(location.hash)},core:{route:function(a){this.path=a,this.action=null,this.do_enter=[],this.do_exit=null,this.params={},f.routes.defined[a]=this}},routes:{current:null,root:null,rescue:null,previous:null,defined:{}}};return f.core.route.prototype={to:function(a){return this.action=a,this},enter:function(a){return a instanceof Array?this.do_enter=this.do_enter.concat(a):this.do_enter.push(a),this},exit:function(a){return this.do_exit=a,this},partition:function(){for(var a,b,c=[],d=[],e=/\(([^}]+?)\)/g;a=e.exec(this.path);)c.push(a[1]);for(d.push(this.path.split("(")[0]),b=0;b<c.length;b++)d.push(d[d.length-1]+c[b]);return d},run:function(){var a,b,c=!1;if(f.routes.defined[this.path].hasOwnProperty("do_enter")&&f.routes.defined[this.path].do_enter.length>0)for(a=0;a<f.routes.defined[this.path].do_enter.length;a++)if(b=f.routes.defined[this.path].do_enter[a].apply(this,null),b===!1){c=!0;break}c||f.routes.defined[this.path].action()}},e.react.router={version:"1.0.5-beta",urlPath:document.location.pathname,init:function(){if("undefined"==typeof f)throw new Error("Pathjs library is required for routing.");f.history.listen(!0),f.routes.rescue=function(){}},mapTo:function(a,b){"undefined"!=typeof f&&f.map(a).to(function(){b(this.params)})},match:function(a){if("undefined"!=typeof f){var b=f.match(a,!0);if(null!=b)return b.run(),!0}return!1},overrideUrl:function(a,b){return a},pushState:function(a,b,c){e.react.router.urlPath="","undefined"!=typeof f&&f.history.pushState(a,b,c)},redirect:function(a){e.react.router.urlPath=a;for(var b in e.react.viewModels){var c=e.react.viewModels[b];if(null!=c&&c.$router.routeUrl())return void(e.debug&&console.log("router> redirected"))}window.location.replace(a)},ssrState:function(a){if(window.ssr&&window.ssr[a]&&!window.ssr[a].fetched)return window.ssr[a].fetched=!0,window.ssr[a]},ssr:function(a,b,c,d,f){e.ssr=!0,e.react.router.urlPath=a,e.react.router.overrideUrl=c;var g=document.createElement("script");g.type="text/javascript",g.text="window.ssr="+b+";";var h=document.getElementsByTagName("head")[0];h?h.insertBefore(g,h.firstChild):console.error("router> document head tag is required for server-side render.");var i=!1,j=f?setTimeout(function(){i||d()},f):0;window.addEventListener("dotnetify.routed",function(){i=!0,0!=j&&clearTimeout(j),d()}),window.ssr=JSON.parse(b)},$ready:function(){this.$router.initRouting()}},e.react.router.$inject=function(c){c.$router=function(c){var f=function(){return{trim:function(a){if("string"!=typeof a)return"";for(;a.indexOf("/",a.length-1)>=0;)a=a.substr(0,a.length-1);for(;0==a.indexOf("/");)a=a.substr(1,a.length-1);return a},equal:function(a,b){return null!=a&&null!=b&&a.toLowerCase()==b.toLowerCase()},startsWith:function(a,b){return a.toLowerCase().slice(0,b.length)==b.toLowerCase()},endsWith:function(a,b){return""==b||a.toLowerCase().slice(-b.length)==b.toLowerCase()},dispatchEvent:function(a){if("function"==typeof Event)window.dispatchEvent(new Event(a));else{var b=document.createEvent("CustomEvent");b.initEvent(a,!0,!0),window.dispatchEvent(b)}},grep:function(a,b){return Array.isArray(a)?a.filter(b):[]}}}();return{routes:[],initRoot:function(){var a=this,b=a.State();if(b.hasOwnProperty("RoutingState")&&null!==b.RoutingState&&null!==b.RoutingState.Root&&a.$router._absRoot!=b.RoutingState.Root){var c=a.$component.props.vmRoot,d=f.trim(c);""!=d&&(d="/"+d);var e=f.trim(b.RoutingState.Root);a.$router._absRoot=""!=e?d+"/"+e:d,b.RoutingState.Root=a.$router._absRoot}}.bind(c),initRouting:function(){var a=this,b=a.State();if(null!=b&&b.hasOwnProperty("RoutingState")){if(null===b.RoutingState)return void console.error("router> the RoutingState prop of '"+a.$vmId+"' was not initialized.");var c=b.RoutingState.Templates;if(null!=c&&0!=c.length){e.react.router.$init||(e.react.router.init(),e.react.router.$init=!0),a.$router.initRoot(),c.forEach(function(b,c){var d=null!=b.UrlPattern?b.UrlPattern:b.Id;d=""!=d?d:"/";var f=a.$router.toUrl(d);e.debug&&console.log("router> map "+f+" to template id="+b.Id),e.react.router.mapTo(f,function(c){e.react.router.urlPath="";var f=d;for(var g in c)f=f.replace(":"+g,c[g]);f=f.replace(/\(\/:([^)]+)\)/g,"").replace(/\(|\)/g,""),a.$router.routeTo(f,b)})});var d=a.$router.toUrl(b.RoutingState.Active);""==e.react.router.urlPath&&(e.react.router.urlPath=d),a.$router.routeUrl()||a.$router.raiseRoutedEvent(!0)}}}.bind(c),isActive:function(a){var b=this.State();return!(null==a||!a.hasOwnProperty("Path"))&&f.equal(a.Path,b.RoutingState.Active)}.bind(c),loadView:function(a,b,c,d,g){var h,i=this,j=i.State();if(j.hasOwnProperty("RoutingState")){if(null===j.RoutingState)return void console.error("router> the RoutingState prop of '"+i.$vmId+"' was not initialized.");var k=i.$component.props.vmRoot;k=null!=k?"/"+f.trim(j.RoutingState.Root)+"/"+f.trim(k):j.RoutingState.Root,h={vmRoot:k,vmArg:d}}b=e.react.router.overrideUrl(b,a),c=e.react.router.overrideUrl(c,a),f.endsWith(b,"html")?i.$router.loadHtmlView(a,b,c,d,g):i.$router.loadReactView(a,b,c,d,h,g)}.bind(c),loadHtmlView:function(a,c,e,f,g){var h=this;try{b.unmountComponentAtNode(document.querySelector(a))}catch(a){console.error(a)}d(a).load(c,null,function(){null!=e?d.getScript(e,function(){"function"==typeof g&&g.call(h)}):"function"==typeof g&&g.call(h)})}.bind(c),loadReactView:function(c,e,f,g,h,i){var j=this,k=function(){if(!window.hasOwnProperty(e))return void console.error("["+j.$vmId+"] failed to load view '"+e+"' because it's not a React element.");try{b.unmountComponentAtNode(document.querySelector(c))}catch(a){console.error(a)}try{var d=a.createElement(window[e],h);b.render(d,document.querySelector(c))}catch(a){console.error(a)}"function"==typeof i&&i.call(j,d)};if(null==f)k();else{var l=f.split(",").map(function(a){return d.getScript(a)});d.when.apply(d,l).done(k)}}.bind(c),manualRouteTo:function(a,b,c,d){var e={Id:"manual",Target:b,ViewUrl:c,JSModuleUrl:d};this.$router.routeTo(a,e,!0)}.bind(c),raiseRoutedEvent:function(a){""!=e.react.router.urlPath&&1!=a||(e.debug&&console.log("router> routed"),f.dispatchEvent("dotnetify.routed"))}.bind(c),routeTo:function(a,b,c,d){var g=this,h=g.State();e.debug&&console.log("router> route '"+a+"' to template id="+b.Id);for(var i in e.react.viewModels){var j=e.react.viewModels[i],k=j.$component.props.vmArg;if(null!=k&&"string"==typeof k["RoutingState.Origin"]&&f.equal(k["RoutingState.Origin"],a))return}if(1==c||!g.hasOwnProperty("onRouteEnter")||0!=g.onRouteEnter(a,b)){if(null===b.Target)return void console.error("router> the Target for template '"+b.Id+"' was not set.  Use vm.onRouteEnter() to set the target.");if(null==document.getElementById(b.Target))return e.debug&&console.log("router> target '"+b.Target+"' not found in DOM, use redirect instead"),e.react.router.redirect(g.$router.toUrl(a));var l=b.ViewUrl?b.ViewUrl:b.Id;g.$router.loadView("#"+b.Target,l,b.JSModuleUrl,{"RoutingState.Origin":a},function(){h.RoutingState.Active=a,g.$dispatch({"RoutingState.Active":a}),g.State({"RoutingState.Active":a}),1!=c&&g.hasOwnProperty("onRouteExit")&&g.onRouteExit(a,b),"function"==typeof d&&d.call(g)}.bind(g))}}.bind(c),routeUrl:function(){var a=this,b=a.State();if(!b.hasOwnProperty("RoutingState"))return!1;var c=b.RoutingState.Root;if(null==c)return!1;var d=e.react.router.urlPath;if(e.debug&&console.log("router> routing "+d),f.equal(d,c)||f.equal(d,c+"/")||"/"===d){var g=f.grep(b.RoutingState.Templates,function(a){return""===a.UrlPattern});return g.length>0&&(a.$router.routeTo("",g[0]),e.react.router.urlPath="",a.$router.raiseRoutedEvent(),!0)}if(c+="/",f.startsWith(d,c)){var h=null,g=f.grep(a.$router.routes,function(a){return f.startsWith(d+"/",a.Url+"/")});if(g.length>0)for(var i=0;i<g.length;i++)(null==h||h.Url.length<g[i].Url.length)&&(h=g[i]);if(null!=h){var j=h.Path,k=a.$router.hasOwnProperty("pathToRoute")&&a.$router.pathToRoute.hasOwnProperty(j)?a.$router.pathToRoute[j].$template:null;if(null!=k)return f.equal(e.react.router.urlPath,a.$router.toUrl(j))&&(e.react.router.urlPath=""),f.equal(b.RoutingState.Active,j)?a.$router.raiseRoutedEvent():a.$router.routeTo(j,k,!1,function(){a.$router.raiseRoutedEvent()}),!0}else if(e.react.router.match(d))return e.react.router.urlPath="",a.$router.raiseRoutedEvent(),!0}return!1}.bind(c),toUrl:function(a){var b=this.State(),c=f.trim(a);return"("!=c.charAt(0)&&""!=c&&(c="/"+c),b.hasOwnProperty("RoutingState")?b.RoutingState.Root+c:a}.bind(c)}}(c),c.$route=function(a,b){var c=this,d=c.State();if(null!=a){if(!a.hasOwnProperty("Path")||!a.hasOwnProperty("TemplateId"))throw new Error("Not a valid route");c.$router.initRoot();var e=a.Path,f=null;if(d.hasOwnProperty("RoutingState")&&null!=d.RoutingState.Templates){var g=d.RoutingState.Templates.filter(function(b){return b.Id==a.TemplateId});if(g.length>0)f=g[0],"string"==typeof b&&(f.Target=b),null==e&&(e=null!=f.UrlPattern?f.UrlPattern:f.Id,a.Path=e);else if(null==a.RedirectRoot)throw new Error("vmRoute cannot find route template '"+a.TemplateId)}if(null!=a.RedirectRoot){var h=a.RedirectRoot;"/"==h.charAt(0)&&(h=h.substr(0,h.length-1));var i=a.RedirectRoot.split("/"),j="",k=c.$component.props.vmRoot;if(null!=k)for(var l=k.split("/"),m=0;m<l.length&&(""==l[m]||l[m]!=i[0]);m++)j+=l[m]+"/";return j+=h+"/"+e,c.$router.routes.push({Path:e,Url:j}),j}if(null==f)throw new Error("vmRoute cannot find any route template");a.$template=f,c.$router.pathToRoute=c.$router.pathToRoute||{},c.$router.pathToRoute[e]=a;var n=c.$router.toUrl(e);return c.$router.routes.push({Path:e,Url:n}),n}}.bind(c),c.$handleRoute=function(a){a.preventDefault();var b=a.currentTarget.pathname;if(null==b||""==b)throw new Error("The event passed to $handleRoute has no path name.");e.react.router.pushState({},"",b)}.bind(c)},e.react.router.RouteLink=function(b){return null==b.vm&&console.error("RouteLink requires 'vm' property."),a.createElement("a",{style:b.style,className:b.className,href:null!=b.route?b.vm.$route(b.route):"",onClick:function(a){return a.preventDefault(),null==b.route?void console.error("RouteLink requires 'route' property."):("function"==typeof b.onClick&&b.onClick(),b.vm.$handleRoute(a))}},b.children)},e.react.router.RouteTarget=c({displayName:"RouteTarget",componentWillMount:function(){var a=document.getElementById(this.props.id);null!=a&&window.ssr&&!window.ssr[this.props.id]?(window.ssr[this.props.id]=!0,this.initialHtml={__html:a.innerHTML}):this.initialHtml={__html:""}},getDOMNode:function(){return this.elem},render:function(){var a=this;return React.createElement("div",d.extend({id:this.props.id,ref:function(b){return a.elem=b}},this.props,{dangerouslySetInnerHTML:this.initialHtml}),this.props.children)}}),e.react.plugins.router=e.react.router,e.react.router}),function(a){"object"==typeof exports&&"object"==typeof module?module.exports=a(require("create-react-class"),require("prop-types"),require("dotnetify")):"function"==typeof define&&define.amd?define(["create-react-class","prop-types","dotnetify"],a):a(createReactClass,PropTypes,dotnetify)}(function(a,b,c){return c.react.Scope=a({displayName:"Scope",version:"1.0.2",propTypes:{vm:b.string},contextTypes:{scoped:b.func},childContextTypes:{scoped:b.func.isRequired,connect:b.func.isRequired},scoped:function(a){var b=this.context.scoped?this.context.scoped(this.props.vm):this.props.vm;return b?b+"."+a:a},getChildContext:function(){var a=this;return{scoped:function(b){return a.scoped(b)},connect:function(b,d,e){return d.vmId=a.scoped(b),d.vm=c.react.connect(d.vmId,d,e),d.dispatch=function(a){return d.vm.$dispatch(a)},d.dispatchState=function(a){d.vm.State(a),d.vm.$dispatch(a)},window.vmStates?window.vmStates[d.vmId]:null}}},render:function(){return this.props.children}}),c.react.Scope});