!function(a){"function"==typeof define&&define.amd?define(["jquery","dotnetify"],a):"object"==typeof exports&&"object"==typeof module?module.exports=a(require("jquery"),require("dotnetify")):a(jQuery,dotnetify)}(function(a,b){var c={version:"0.8.4",map:function(a){return c.routes.defined.hasOwnProperty(a)?c.routes.defined[a]:new c.core.route(a)},root:function(a){c.routes.root=a},rescue:function(a){c.routes.rescue=a},history:{initial:{},pushState:function(a,b,d){c.history.supported?c.dispatch(d)&&history.pushState(a,b,d):c.history.fallback&&(window.location.hash="#"+d)},popState:function(a){var b=!c.history.initial.popped&&location.href==c.history.initial.URL;c.history.initial.popped=!0,b||c.dispatch(document.location.pathname)},listen:function(a){if(c.history.supported=!(!window.history||!window.history.pushState),c.history.fallback=a,c.history.supported)c.history.initial.popped="state"in window.history,c.history.initial.URL=location.href,window.onpopstate=c.history.popState;else if(c.history.fallback){for(route in c.routes.defined)"#"!=route.charAt(0)&&(c.routes.defined["#"+route]=c.routes.defined[route],c.routes.defined["#"+route].path="#"+route);c.listen()}}},match:function(a,b){var d,e,f,g,h,i={},j=null;for(j in c.routes.defined)if(null!==j&&void 0!==j)for(j=c.routes.defined[j],d=j.partition(),g=0;g<d.length;g++){if(e=d[g],h=a,e.search(/:/)>0)for(f=0;f<e.split("/").length;f++)f<h.split("/").length&&":"===e.split("/")[f].charAt(0)&&(i[e.split("/")[f].replace(/:/,"")]=h.split("/")[f],h=h.replace(h.split("/")[f],e.split("/")[f]));if(e===h)return b&&(j.params=i),j}return null},dispatch:function(a){var b,d;if(c.routes.current!==a){if(c.routes.previous=c.routes.current,c.routes.current=a,d=c.match(a,!0),c.routes.previous&&(b=c.match(c.routes.previous),null!==b&&null!==b.do_exit&&b.do_exit()),null!==d)return d.run(),!0;null!==c.routes.rescue&&c.routes.rescue()}},listen:function(){var a=function(){c.dispatch(location.hash)};""===location.hash&&null!==c.routes.root&&(location.hash=c.routes.root),"onhashchange"in window&&(!document.documentMode||document.documentMode>=8)?window.onhashchange=a:setInterval(a,50),""!==location.hash&&c.dispatch(location.hash)},core:{route:function(a){this.path=a,this.action=null,this.do_enter=[],this.do_exit=null,this.params={},c.routes.defined[a]=this}},routes:{current:null,root:null,rescue:null,previous:null,defined:{}}};return c.core.route.prototype={to:function(a){return this.action=a,this},enter:function(a){return a instanceof Array?this.do_enter=this.do_enter.concat(a):this.do_enter.push(a),this},exit:function(a){return this.do_exit=a,this},partition:function(){for(var a,b,c=[],d=[],e=/\(([^}]+?)\)/g;a=e.exec(this.path);)c.push(a[1]);for(d.push(this.path.split("(")[0]),b=0;b<c.length;b++)d.push(d[d.length-1]+c[b]);return d},run:function(){var a,b,d=!1;if(c.routes.defined[this.path].hasOwnProperty("do_enter")&&c.routes.defined[this.path].do_enter.length>0)for(a=0;a<c.routes.defined[this.path].do_enter.length;a++)if(b=c.routes.defined[this.path].do_enter[a](),b===!1){d=!0;break}d||c.routes.defined[this.path].action()}},b.react.router={version:"1.0.1-beta",urlPath:document.location.pathname,init:function(){if("undefined"==typeof c)throw new Error("Pathjs library is required for routing.");c.history.listen(!0),c.routes.rescue=function(){}},mapTo:function(a,b){"undefined"!=typeof c&&c.map(a).to(function(){b(this.params)})},match:function(a){if("undefined"!=typeof c){var b=c.match(a,!0);if(null!=b)return b.run(),!0}return!1},overrideUrl:function(a){return a},pushState:function(a,d,e){b.react.router.urlPath="","undefined"!=typeof c&&c.history.pushState(a,d,e)},redirect:function(a){b.react.router.urlPath=a;for(var c in b.react.viewModels){var d=b.react.viewModels[c];if(null!=d&&d.$router.routeUrl())return}window.location.replace(a)},$ready:function(){this.$router.initRouting()}},b.react.router.$inject=function(c){c.$router=function(c){var d=function(){return{trim:function(a){if("string"!=typeof a)return"";for(;a.indexOf("/",a.length-1)>=0;)a=a.substr(0,a.length-1);for(;0==a.indexOf("/");)a=a.substr(1,a.length-1);return a},equal:function(a,b){return null!=a&&null!=b&&a.toLowerCase()==b.toLowerCase()},startsWith:function(a,b){return a.toLowerCase().slice(0,b.length)==b.toLowerCase()},endsWith:function(a,b){return""==b||a.toLowerCase().slice(-b.length)==b.toLowerCase()}}}();return{routes:[],initRoot:function(){var a=this,b=a.State();if(b.hasOwnProperty("RoutingState")&&null!==b.RoutingState&&null!==b.RoutingState.Root&&a.$router._absRoot!=b.RoutingState.Root){var c=a.$component.props.vmRoot,e=d.trim(c);""!=e&&(e="/"+e);var f=d.trim(b.RoutingState.Root);a.$router._absRoot=""!=f?e+"/"+f:e,b.RoutingState.Root=a.$router._absRoot}}.bind(c),initRouting:function(){var c=this,d=c.State();if(null!=d&&d.hasOwnProperty("RoutingState")){if(null===d.RoutingState)return void console.error("router> the RoutingState prop of '"+c.$vmId+"' was not initialized.");var e=d.RoutingState.Templates;if(null!=e&&0!=e.length){b.react.router.$init||(b.react.router.init(),b.react.router.$init=!0),c.$router.initRoot(),a.each(e,function(a,d){var e=null!=d.UrlPattern?d.UrlPattern:d.Id,f=c.$router.toUrl(e);b.debug&&console.log("router> map "+f+" to template id="+d.Id),b.react.router.mapTo(f,function(a){b.react.router.urlPath="";var f=e;for(param in a)f=f.replace(":"+param,a[param]);f=f.replace(/\(\/:([^)]+)\)/g,"").replace(/\(|\)/g,""),c.$router.routeTo(f,d)})});var f=c.$router.toUrl(d.RoutingState.Active);""==b.react.router.urlPath&&(b.react.router.urlPath=f),c.$router.routeUrl()}}}.bind(c),isActive:function(a){var b=this.State();return!(null==a||!a.hasOwnProperty("Path"))&&d.equal(a.Path,b.RoutingState.Active)}.bind(c),loadView:function(a,c,e,f,g){var h,i=this,j=i.State();if(j.hasOwnProperty("RoutingState")){if(null===j.RoutingState)return void console.error("router> the RoutingState prop of '"+i.$vmId+"' was not initialized.");var k=i.$component.props.vmRoot;k=null!=k?"/"+d.trim(j.RoutingState.Root)+"/"+d.trim(k):j.RoutingState.Root,h={vmRoot:k,vmArg:f}}e=b.react.router.overrideUrl(e),d.endsWith(c,"html")?i.$loadHtmlView(a,c,e,f,g):i.$loadReactView(a,c,e,f,h,g)}.bind(c),manualRouteTo:function(a,b,c,d){var e={Id:"manual",Target:b,ViewUrl:c,JSModuleUrl:d};this.$router.routeTo(a,e,!0)}.bind(c),routeTo:function(a,c,e){var f=this,g=f.State();b.debug&&console.log("router> route '"+a+"' to template id="+c.Id);for(var h in b.react.viewModels){var i=b.react.viewModels[h],j=i.$component.props.vmArg;if(null!=j&&"string"==typeof j["RoutingState.Origin"]&&d.equal(j["RoutingState.Origin"],a))return}if(1==e||!f.hasOwnProperty("onRouteEnter")||0!=f.onRouteEnter(a,c)){if(null===c.Target)return void console.error("router> the Target for template '"+c.Id+"' was not set.  Use vm.onRouteEnter() to set the target.");if(null==document.getElementById(c.Target))return b.debug&&console.log("router> target '"+c.Target+"' not found in DOM, use redirect instead"),b.react.router.redirect(f.$router.toUrl(a));var k=c.ViewUrl?c.ViewUrl:c.Id;f.$router.loadView("#"+c.Target,k,c.JSModuleUrl,{"RoutingState.Origin":a},function(){g.RoutingState.Active=a,f.$dispatch({"RoutingState.Active":a}),1!=e&&f.hasOwnProperty("onRouteExit")&&f.onRouteExit(a,c)}.bind(f))}}.bind(c),routeUrl:function(){var c=this,e=c.State();if(!e.hasOwnProperty("RoutingState"))return!1;var f=e.RoutingState.Root;if(null==f)return!1;var g=b.react.router.urlPath;if(b.debug&&console.log("router> routing "+g),d.equal(g,f)||d.equal(g,f+"/")||"/"===g){var h=a.grep(e.RoutingState.Templates,function(a){return""===a.UrlPattern});return void(h.length>0&&c.$router.routeTo("",h[0]))}if(f+="/",d.startsWith(g,f)){var j=null,h=a.grep(c.$router.routes,function(a){return d.startsWith(g,a.Url)});if(h.length>0)for(i=0;i<h.length;i++)(null==j||j.Url.length<a(h[i]).get(0).Url.length)&&(j=h[i]);if(null!=j){var k=j.Path,l=c.$router.hasOwnProperty("pathToRoute")&&c.$router.pathToRoute.hasOwnProperty(k)?c.$router.pathToRoute[k].$template:null;if(null!=l)return d.equal(b.react.router.urlPath,c.$router.toUrl(k))&&(b.react.router.urlPath=""),d.equal(e.RoutingState.Active,k)||c.$router.routeTo(k,l),!0}else if(b.react.router.match(g))return b.react.router.urlPath="",!0}return!1}.bind(c),toUrl:function(a){var b=this.State(),c=d.trim(a);return"("!=c.charAt(0)&&""!=c&&(c="/"+c),b.hasOwnProperty("RoutingState")?b.RoutingState.Root+c:a}.bind(c)}}(c),c.$route=function(b,c){var d=this,e=d.State();if(null!=b){if(!b.hasOwnProperty("Path")||!b.hasOwnProperty("TemplateId"))throw new Error("Not a valid route");d.$router.initRoot(),path=b.Path;var f=null;if(e.hasOwnProperty("RoutingState")&&null!=e.RoutingState.Templates){var g=a.grep(e.RoutingState.Templates,function(a){return a.Id==b.TemplateId});if(g.length>0)f=g[0],"string"==typeof c&&(f.Target=c),null==path&&(path=null!=f.UrlPattern?f.UrlPattern:f.Id,b.Path=path);else if(null==b.RedirectRoot)throw new Error("vmRoute cannot find route template '"+b.TemplateId)}if(null!=b.RedirectRoot){var h=b.RedirectRoot;"/"==h.charAt(0)&&(h=h.substr(0,h.length-1));var j=b.RedirectRoot.split("/"),k="",l=d.$component.props.vmRoot;if(null!=l){var m=l.split("/");for(i=0;i<m.length&&(""==m[i]||m[i]!=j[0]);i++)k+=m[i]+"/"}return k+=h+"/"+path,d.$router.routes.push({Path:path,Url:k}),k}if(null==f)throw new Error("vmRoute cannot find any route template");b.$template=f,d.$router.pathToRoute=d.$router.pathToRoute||{},d.$router.pathToRoute[path]=b;var n=d.$router.toUrl(path);return d.$router.routes.push({Path:path,Url:n}),n}}.bind(c),c.$handleRoute=function(a){a.preventDefault();var c=a.currentTarget.pathname;if(null==c||""==c)throw new Error("The event passed to $handleRoute has no path name.");b.react.router.pushState({},"",c)}.bind(c)},b.react.plugins.router=b.react.router,b.react.router.RouteLink=function(a){return null==a.vm?console.error("RouteLink requires 'vm' property."):null==a.route&&console.error("RouteLink requires 'route' property."),React.createElement("a",{style:a.style,className:a.className,href:a.vm.$route(a.route),onClick:function(b){return b.preventDefault(),"function"==typeof a.onClick&&a.onClick(),a.vm.$handleRoute(b)}},a.children)},b.react.router});