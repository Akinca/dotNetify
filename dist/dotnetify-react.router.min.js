!function(a){"function"==typeof define&&define.amd?define(["react","jquery","dotnetify"],a):"object"==typeof exports&&"object"==typeof module?module.exports=a(require("react"),require("jquery"),require("dotnetify")):a(React,jQuery,dotnetify)}(function(a,b,c){var d={version:"0.8.5",map:function(a){return d.routes.defined.hasOwnProperty(a)?d.routes.defined[a]:new d.core.route(a)},root:function(a){d.routes.root=a},rescue:function(a){d.routes.rescue=a},history:{initial:{},pushState:function(a,b,c){d.history.supported?d.dispatch(c)&&history.pushState(a,b,c):d.history.fallback&&(window.location.hash="#"+c)},popState:function(a){var b=!d.history.initial.popped&&location.href==d.history.initial.URL;d.history.initial.popped=!0,b||d.dispatch(document.location.pathname)},listen:function(a){if(d.history.supported=!(!window.history||!window.history.pushState),d.history.fallback=a,d.history.supported)d.history.initial.popped="state"in window.history,d.history.initial.URL=location.href,window.onpopstate=d.history.popState;else if(d.history.fallback){for(route in d.routes.defined)"#"!=route.charAt(0)&&(d.routes.defined["#"+route]=d.routes.defined[route],d.routes.defined["#"+route].path="#"+route);d.listen()}}},match:function(a,b){var c,e,f,g,h,i,j={},k=null;for(k in d.routes.defined)if(null!==k&&void 0!==k)for(k=d.routes.defined[k],c=k.partition(),g=0;g<c.length;g++){if(e=c[g],h=a,e.search(/:/)>0)for(f=0;f<e.split("/").length;f++)f<h.split("/").length&&":"===e.split("/")[f].charAt(0)&&(j[e.split("/")[f].replace(/:/,"")]=h.split("/")[f],i=h.split("/"),i[f]=e.split("/")[f],h=i.join("/"));if(e===h)return b&&(k.params=j),k}return null},dispatch:function(a){var b,c;if(d.routes.current!==a){if(d.routes.previous=d.routes.current,d.routes.current=a,c=d.match(a,!0),d.routes.previous&&(b=d.match(d.routes.previous),null!==b&&null!==b.do_exit&&b.do_exit()),null!==c)return c.run(),!0;null!==d.routes.rescue&&d.routes.rescue()}},listen:function(){var a=function(){d.dispatch(location.hash)};""===location.hash&&null!==d.routes.root&&(location.hash=d.routes.root),"onhashchange"in window&&(!document.documentMode||document.documentMode>=8)?window.onhashchange=a:setInterval(a,50),""!==location.hash&&d.dispatch(location.hash)},core:{route:function(a){this.path=a,this.action=null,this.do_enter=[],this.do_exit=null,this.params={},d.routes.defined[a]=this}},routes:{current:null,root:null,rescue:null,previous:null,defined:{}}};return d.core.route.prototype={to:function(a){return this.action=a,this},enter:function(a){return a instanceof Array?this.do_enter=this.do_enter.concat(a):this.do_enter.push(a),this},exit:function(a){return this.do_exit=a,this},partition:function(){for(var a,b,c=[],d=[],e=/\(([^}]+?)\)/g;a=e.exec(this.path);)c.push(a[1]);for(d.push(this.path.split("(")[0]),b=0;b<c.length;b++)d.push(d[d.length-1]+c[b]);return d},run:function(){var a,b,c=!1;if(d.routes.defined[this.path].hasOwnProperty("do_enter")&&d.routes.defined[this.path].do_enter.length>0)for(a=0;a<d.routes.defined[this.path].do_enter.length;a++)if(b=d.routes.defined[this.path].do_enter[a].apply(this,null),b===!1){c=!0;break}c||d.routes.defined[this.path].action()}},c.react.router={version:"1.0.3-beta",urlPath:document.location.pathname,init:function(){if("undefined"==typeof d)throw new Error("Pathjs library is required for routing.");d.history.listen(!0),d.routes.rescue=function(){}},mapTo:function(a,b){"undefined"!=typeof d&&d.map(a).to(function(){b(this.params)})},match:function(a){if("undefined"!=typeof d){var b=d.match(a,!0);if(null!=b)return b.run(),!0}return!1},overrideUrl:function(a,b){return a},pushState:function(a,b,e){c.react.router.urlPath="","undefined"!=typeof d&&d.history.pushState(a,b,e)},redirect:function(a){c.react.router.urlPath=a;for(var b in c.react.viewModels){var d=c.react.viewModels[b];if(null!=d&&d.$router.routeUrl())return void(c.debug&&console.log("router> redirected"))}window.location.replace(a)},ssrState:function(a){if(window.ssr&&window.ssr[a]&&!window.ssr[a].fetched)return window.ssr[a].fetched=!0,window.ssr[a]},ssr:function(a,b,d,e,f){c.ssr=!0,c.react.router.urlPath=a,c.react.router.overrideUrl=d;var g=document.createElement("script");g.type="text/javascript",g.text="window.ssr="+b+";";var h=document.getElementsByTagName("head")[0];h?h.insertBefore(g,h.firstChild):console.error("router> document head tag is required for server-side render.");var i=!1,j=f?setTimeout(function(){i||e()},f):0;window.addEventListener("dotnetify.routed",function(){i=!0,0!=j&&clearTimeout(j),e()}),window.ssr=JSON.parse(b)},$ready:function(){this.$router.initRouting()}},c.react.router.$inject=function(a){a.$router=function(a){var d=function(){return{trim:function(a){if("string"!=typeof a)return"";for(;a.indexOf("/",a.length-1)>=0;)a=a.substr(0,a.length-1);for(;0==a.indexOf("/");)a=a.substr(1,a.length-1);return a},equal:function(a,b){return null!=a&&null!=b&&a.toLowerCase()==b.toLowerCase()},startsWith:function(a,b){return a.toLowerCase().slice(0,b.length)==b.toLowerCase()},endsWith:function(a,b){return""==b||a.toLowerCase().slice(-b.length)==b.toLowerCase()},dispatchEvent:function(a){if("function"==typeof Event)window.dispatchEvent(new Event(a));else{var b=document.createEvent("CustomEvent");b.initEvent(a,!0,!0),window.dispatchEvent(b)}}}}();return{routes:[],initRoot:function(){var a=this,b=a.State();if(b.hasOwnProperty("RoutingState")&&null!==b.RoutingState&&null!==b.RoutingState.Root&&a.$router._absRoot!=b.RoutingState.Root){var c=a.$component.props.vmRoot,e=d.trim(c);""!=e&&(e="/"+e);var f=d.trim(b.RoutingState.Root);a.$router._absRoot=""!=f?e+"/"+f:e,b.RoutingState.Root=a.$router._absRoot}}.bind(a),initRouting:function(){var a=this,d=a.State();if(null!=d&&d.hasOwnProperty("RoutingState")){if(null===d.RoutingState)return void console.error("router> the RoutingState prop of '"+a.$vmId+"' was not initialized.");var e=d.RoutingState.Templates;if(null!=e&&0!=e.length){c.react.router.$init||(c.react.router.init(),c.react.router.$init=!0),a.$router.initRoot(),b.each(e,function(b,d){var e=null!=d.UrlPattern?d.UrlPattern:d.Id;e=""!=e?e:"/";var f=a.$router.toUrl(e);c.debug&&console.log("router> map "+f+" to template id="+d.Id),c.react.router.mapTo(f,function(b){c.react.router.urlPath="";var f=e;for(var g in b)f=f.replace(":"+g,b[g]);f=f.replace(/\(\/:([^)]+)\)/g,"").replace(/\(|\)/g,""),a.$router.routeTo(f,d)})});var f=a.$router.toUrl(d.RoutingState.Active);""==c.react.router.urlPath&&(c.react.router.urlPath=f),a.$router.routeUrl()||a.$router.raiseRoutedEvent(!0)}}}.bind(a),isActive:function(a){var b=this.State();return!(null==a||!a.hasOwnProperty("Path"))&&d.equal(a.Path,b.RoutingState.Active)}.bind(a),loadView:function(a,b,e,f,g){var h,i=this,j=i.State();if(j.hasOwnProperty("RoutingState")){if(null===j.RoutingState)return void console.error("router> the RoutingState prop of '"+i.$vmId+"' was not initialized.");var k=i.$component.props.vmRoot;k=null!=k?"/"+d.trim(j.RoutingState.Root)+"/"+d.trim(k):j.RoutingState.Root,h={vmRoot:k,vmArg:f}}b=c.react.router.overrideUrl(b,a),e=c.react.router.overrideUrl(e,a),d.endsWith(b,"html")?i.$loadHtmlView(a,b,e,f,g):i.$loadReactView(a,b,e,f,h,g)}.bind(a),manualRouteTo:function(a,b,c,d){var e={Id:"manual",Target:b,ViewUrl:c,JSModuleUrl:d};this.$router.routeTo(a,e,!0)}.bind(a),raiseRoutedEvent:function(a){""!=c.react.router.urlPath&&1!=a||(c.debug&&console.log("router> routed"),d.dispatchEvent("dotnetify.routed"))}.bind(a),routeTo:function(a,b,e,f){var g=this,h=g.State();c.debug&&console.log("router> route '"+a+"' to template id="+b.Id);for(var i in c.react.viewModels){var j=c.react.viewModels[i],k=j.$component.props.vmArg;if(null!=k&&"string"==typeof k["RoutingState.Origin"]&&d.equal(k["RoutingState.Origin"],a))return}if(1==e||!g.hasOwnProperty("onRouteEnter")||0!=g.onRouteEnter(a,b)){if(null===b.Target)return void console.error("router> the Target for template '"+b.Id+"' was not set.  Use vm.onRouteEnter() to set the target.");if(null==document.getElementById(b.Target))return c.debug&&console.log("router> target '"+b.Target+"' not found in DOM, use redirect instead"),c.react.router.redirect(g.$router.toUrl(a));var l=b.ViewUrl?b.ViewUrl:b.Id;g.$router.loadView("#"+b.Target,l,b.JSModuleUrl,{"RoutingState.Origin":a},function(){h.RoutingState.Active=a,g.$dispatch({"RoutingState.Active":a}),g.State({"RoutingState.Active":a}),1!=e&&g.hasOwnProperty("onRouteExit")&&g.onRouteExit(a,b),"function"==typeof f&&f.call(g)}.bind(g))}}.bind(a),routeUrl:function(){var a=this,e=a.State();if(!e.hasOwnProperty("RoutingState"))return!1;var f=e.RoutingState.Root;if(null==f)return!1;var g=c.react.router.urlPath;if(c.debug&&console.log("router> routing "+g),d.equal(g,f)||d.equal(g,f+"/")||"/"===g){var h=b.grep(e.RoutingState.Templates,function(a){return""===a.UrlPattern});return h.length>0&&(a.$router.routeTo("",h[0]),c.react.router.urlPath="",a.$router.raiseRoutedEvent(),!0)}if(f+="/",d.startsWith(g,f)){var i=null,h=b.grep(a.$router.routes,function(a){return d.startsWith(g+"/",a.Url+"/")});if(h.length>0)for(var j=0;j<h.length;j++)(null==i||i.Url.length<b(h[j]).get(0).Url.length)&&(i=h[j]);if(null!=i){var k=i.Path,l=a.$router.hasOwnProperty("pathToRoute")&&a.$router.pathToRoute.hasOwnProperty(k)?a.$router.pathToRoute[k].$template:null;if(null!=l)return d.equal(c.react.router.urlPath,a.$router.toUrl(k))&&(c.react.router.urlPath=""),d.equal(e.RoutingState.Active,k)?a.$router.raiseRoutedEvent():a.$router.routeTo(k,l,!1,function(){a.$router.raiseRoutedEvent()}),!0}else if(c.react.router.match(g))return c.react.router.urlPath="",a.$router.raiseRoutedEvent(),!0}return!1}.bind(a),toUrl:function(a){var b=this.State(),c=d.trim(a);return"("!=c.charAt(0)&&""!=c&&(c="/"+c),b.hasOwnProperty("RoutingState")?b.RoutingState.Root+c:a}.bind(a)}}(a),a.$route=function(a,c){var d=this,e=d.State();if(null!=a){if(!a.hasOwnProperty("Path")||!a.hasOwnProperty("TemplateId"))throw new Error("Not a valid route");d.$router.initRoot();var f=a.Path,g=null;if(e.hasOwnProperty("RoutingState")&&null!=e.RoutingState.Templates){var h=b.grep(e.RoutingState.Templates,function(b){return b.Id==a.TemplateId});if(h.length>0)g=h[0],"string"==typeof c&&(g.Target=c),null==f&&(f=null!=g.UrlPattern?g.UrlPattern:g.Id,a.Path=f);else if(null==a.RedirectRoot)throw new Error("vmRoute cannot find route template '"+a.TemplateId)}if(null!=a.RedirectRoot){var i=a.RedirectRoot;"/"==i.charAt(0)&&(i=i.substr(0,i.length-1));var j=a.RedirectRoot.split("/"),k="",l=d.$component.props.vmRoot;if(null!=l)for(var m=l.split("/"),n=0;n<m.length&&(""==m[n]||m[n]!=j[0]);n++)k+=m[n]+"/";return k+=i+"/"+f,d.$router.routes.push({Path:f,Url:k}),k}if(null==g)throw new Error("vmRoute cannot find any route template");a.$template=g,d.$router.pathToRoute=d.$router.pathToRoute||{},d.$router.pathToRoute[f]=a;var o=d.$router.toUrl(f);return d.$router.routes.push({Path:f,Url:o}),o}}.bind(a),a.$handleRoute=function(a){a.preventDefault();var b=a.currentTarget.pathname;if(null==b||""==b)throw new Error("The event passed to $handleRoute has no path name.");c.react.router.pushState({},"",b)}.bind(a)},c.react.router.RouteLink=function(b){return null==b.vm&&console.error("RouteLink requires 'vm' property."),a.createElement("a",{style:b.style,className:b.className,href:null!=b.route?b.vm.$route(b.route):"",onClick:function(a){return a.preventDefault(),null==b.route?void console.error("RouteLink requires 'route' property."):("function"==typeof b.onClick&&b.onClick(),b.vm.$handleRoute(a))}},b.children)},c.react.router.RouteTarget=a.createClass({displayName:"RouteTarget",componentWillMount:function(){var a=document.getElementById(this.props.id);null!=a&&window.ssr&&!window.ssr[this.props.id]?(window.ssr[this.props.id]=!0,this.initialHtml={__html:a.innerHTML}):this.initialHtml={__html:""}},getDOMNode:function(){return this.elem},render:function(){var a=this;return React.createElement("div",b.extend({id:this.props.id,ref:function(b){return a.elem=b}},this.props,{dangerouslySetInnerHTML:this.initialHtml}),this.props.children)}}),c.react.plugins.router=c.react.router,c.react.router});